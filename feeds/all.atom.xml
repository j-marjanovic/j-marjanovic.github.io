<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>j-marjanovic.io</title><link href="www.j-marjanovic.io/" rel="alternate"></link><link href="www.j-marjanovic.io/feeds/all.atom.xml" rel="self"></link><id>www.j-marjanovic.io/</id><updated>2019-11-02T12:30:00+01:00</updated><entry><title>Books read: Synchrotron Radiation Sources</title><link href="www.j-marjanovic.io/books-read-synchrotron-radiation-sources.html" rel="alternate"></link><published>2019-11-02T12:30:00+01:00</published><updated>2019-11-02T12:30:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2019-11-02:www.j-marjanovic.io/books-read-synchrotron-radiation-sources.html</id><summary type="html">&lt;p&gt;Here are my notes on the book "Synchrotron Radiation Sources: A Primer", edited
by H. Winick. Although a little bit dated (the book is from 1995) it gives a
nice overview of all components of a modern synchrotron and helps with better
understanding of how all subsystem interconnect together. It …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Here are my notes on the book "Synchrotron Radiation Sources: A Primer", edited
by H. Winick. Although a little bit dated (the book is from 1995) it gives a
nice overview of all components of a modern synchrotron and helps with better
understanding of how all subsystem interconnect together. It also serves as a
good introduction in the field of machine physics, which was for me (I have a
diploma degree in electronics) quite effective to better understand the
challenges faced in synchrotrons of the 4th generation (diffraction-limited
storage rings).&lt;/p&gt;
&lt;p style="width:80%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Synchrotron Radiation Sources: A Primer" src="www.j-marjanovic.io/images/synchrotron_light_sources.jpg"&gt;&lt;/p&gt;
&lt;h1&gt;Chapter 1&lt;/h1&gt;
&lt;p&gt;page 2: "electron (or positrons)" --&amp;gt; how would a a SLS with protons look like?
larger insertions devices? different SR wavelengths?&lt;/p&gt;
&lt;p&gt;page 4: betatron - early machines, vertical magnetic field (spatially const,
time varying)&lt;/p&gt;
&lt;p&gt;page 7: non top-up mode --&amp;gt; from what I heard it took several hours to start
the machine&lt;/p&gt;
&lt;p&gt;page 9: &lt;span class="math"&gt;\(\gamma = \frac{mc^2}{E}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;page 12: time structure - ESRF hybrid mode: "pulsed experiments in us, ns and ps
time scale" (&lt;em&gt;M. Wulff et al., Time-resolved structures of macromolecules at the
ESRF&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;page 13: are the main advantage of FELs short pulses or higher brightness?&lt;/p&gt;
&lt;p&gt;page 15: TESLA CDR published in 1988, the book is from 1994.&lt;/p&gt;
&lt;h1&gt;Chapter 2&lt;/h1&gt;
&lt;p&gt;page 34: theory on strong focusing --&amp;gt; very interesting, study &lt;em&gt;E. D. Curant et
al., Theory of the alternating-gradient synchrotron&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;page 35: are betatron oscillations period or is there a phase advance?&lt;/p&gt;
&lt;p&gt;page 39: (slightly) rotated quadrupoles introduce x-y coupling&lt;/p&gt;
&lt;p&gt;page 41: correctors at the beggining and at the end of the insertion device --&amp;gt;
modern take presented in &lt;em&gt;G. Rehm et al.: First projects at Diamond Light Source
involving MTCA&lt;/em&gt;
(https://indico.desy.de/indico/event/20703/session/0/contribution/77/material/slides/1.pdf, page 9)&lt;/p&gt;
&lt;p&gt;page 41: what is a "tune shift"?&lt;/p&gt;
&lt;p&gt;page 43: planar design --&amp;gt; prevents orbit "growth" in y (apart from coupling from quadrupoles)&lt;/p&gt;
&lt;p&gt;page 44: dispersion-free region&lt;/p&gt;
&lt;p&gt;page 46: dynamic aperture: max betatron osc that can be sustained&lt;/p&gt;
&lt;p&gt;page 48: for how much do insertion devices reduce the energy? is this important
for the orbit?&lt;/p&gt;
&lt;p&gt;page 49: vertical/horizontal emittance ratio for most machines: 0.01 to 0.03&lt;/p&gt;
&lt;h1&gt;Chapter 3&lt;/h1&gt;
&lt;p&gt;page 60: septum magnets: what is the purpose, how do they work&lt;/p&gt;
&lt;p&gt;page 62: off axis &amp;lt;-/-&amp;gt; on axis&lt;/p&gt;
&lt;p&gt;page 68: max booster boost ratio of 50, in reality a little less. example 1:
DESY II (injection at 450 MeV, ejection at 6 GeV - factor 13). example 2: SPS
(max energy 450 GeV) to LHC (max energy 6500 GeV), factor 14&lt;/p&gt;
&lt;p&gt;page 65: RF photo cathode gun now more popular&lt;/p&gt;
&lt;p&gt;page 73: "brute force" used at MedAustron&lt;/p&gt;
&lt;p&gt;page 75: 3 kA, 13 kV!!!&lt;/p&gt;
&lt;p&gt;page 78: high-Z = high atomic number (e.g. W, Pb)&lt;/p&gt;
&lt;p&gt;page 81: harmonic nr = number of buckets&lt;/p&gt;
&lt;h1&gt;Chapter 4&lt;/h1&gt;
&lt;p&gt;page 95: first mention of time-resolved measurement&lt;/p&gt;
&lt;p&gt;page 91: synchrotron osc = longitudinal, betatron osc = transversal&lt;/p&gt;
&lt;p&gt;page 96: cavity impedance scales lineraly with the number of cells&lt;/p&gt;
&lt;p&gt;page 105: what about traveling-wave cavity? is this used in SLS?&lt;/p&gt;
&lt;p&gt;page 111: How a Klystron amplifier works (https://www.youtube.com/watch?v=Fvud81pYGOg)&lt;/p&gt;
&lt;p&gt;page 117: protection for kylstron: Klystron Lifetime Management (http://accelconf.web.cern.ch/AccelConf/ICALEPCS2013/talks/tucoca09_talk.pdf)&lt;/p&gt;
&lt;h1&gt;Chapter 5&lt;/h1&gt;
&lt;p&gt;page 122: photon BPMs to global orbit feedback also possible - Diamond, ELETTRA
(here only local feedback is described)&lt;/p&gt;
&lt;p&gt;page 132: "DIAMOND at Deresbury"&lt;/p&gt;
&lt;p&gt;page 145: "the designer is relying very much on the good will of the stell
company" --&amp;gt; the reality we work in&lt;/p&gt;
&lt;h1&gt;Chapter 6&lt;/h1&gt;
&lt;p&gt;page 159: digital feedback have taken over since the book was written&lt;/p&gt;
&lt;h1&gt;Chapter 7&lt;/h1&gt;
&lt;p&gt;page 163: book is from 1994, more modern methods could be used -&amp;gt; PXI or MTCA
crate with motor controller and fast ADC&lt;/p&gt;
&lt;p&gt;page 194: corrector magnets are not mentioned, but it would be convenient (and
interesting) to measure the resp with high freq (e.g. at 1 kHz)&lt;/p&gt;
&lt;h1&gt;Chapter 8&lt;/h1&gt;
&lt;p&gt;page 197: "the beam would propagate only a few meters in atmosphere" --&amp;gt; more
than I would expect&lt;/p&gt;
&lt;p&gt;page 199: desorption &amp;lt;-/-&amp;gt; absorption (photon- and electron-stimulated desorbtion)&lt;/p&gt;
&lt;p&gt;page 203: beam stop - photones after diploe --&amp;gt; more than 10 kW of power&lt;/p&gt;
&lt;p&gt;page 211: 1e-11 Torr = still 1e11 molecules per L (= 2.5e22 molecules/L of air *
1e-11 Tor in atm)&lt;/p&gt;
&lt;h1&gt;Chapter 9&lt;/h1&gt;
&lt;p&gt;page 218: AI: last wave of AI, Lisp-based, very advanced but still very limited (=specific)&lt;/p&gt;
&lt;p&gt;page 219: interesting from historical point of view - only EPICS is mentioned&lt;/p&gt;
&lt;p&gt;page 220: communication protocols from the past Bitbus (http://accelconf.web.cern.ch/accelconf/p91/PDF/PAC1991_1496.PDF)
and Multibus &lt;/p&gt;
&lt;p&gt;page 220: reflective memory techniques (for FOFB)&lt;/p&gt;
&lt;p&gt;page 225: drift and negative drift sounds very hackish; wouldn't it be easier to
take the position and angle of the insertion device (2 step simulation)&lt;/p&gt;
&lt;p&gt;page 226: check ref 27: "Computer Codes for Particle Accelerator Design and
Analysis: A Compendium"&lt;/p&gt;
&lt;p&gt;page 227: phase-space 6D - x, x', y, y' dp/p, ds - each coordinate relative
to ideal orbit&lt;/p&gt;
&lt;p&gt;page 228: R matrix sometimes 2x2, should is be 6x6 in "normal" case? find some
examples for individual elements ...&lt;/p&gt;
&lt;p&gt;page 228: beta-function is a solution for single particle motion&lt;/p&gt;
&lt;p&gt;page 229: Twiss parameters &amp;lt;-&amp;gt; beta func and beta' (alfa, beta, gamma)&lt;/p&gt;
&lt;p&gt;page 239: read again G. Strang: Linear Algebra and Its Applications&lt;/p&gt;
&lt;h1&gt;Chapter 10&lt;/h1&gt;
&lt;p&gt;page 245: time-resolved spectroscopy - learn more on this&lt;/p&gt;
&lt;p&gt;page 251: "Signal Processing" chapter was written before DSP became mainstream&lt;/p&gt;
&lt;p&gt;page 262: section on BPM is rather short --&amp;gt; study ref 61: K. Wittenburg "Beam
Loss Detection"&lt;/p&gt;
&lt;p&gt;page 271: wire scan is not mentioned?&lt;/p&gt;
&lt;h1&gt;Chapter 11&lt;/h1&gt;
&lt;p&gt;page 297: successive alignment steps: non-converging, circling around 0 in
N-dim space&lt;/p&gt;
&lt;p&gt;page 301: "Cultural noise at DESY" :D&lt;/p&gt;
&lt;h1&gt;Chapter 12&lt;/h1&gt;
&lt;p&gt;page 306: "resonate for a long time" - wake field decay --&amp;gt; check at FLASH&lt;/p&gt;
&lt;p&gt;page 308: slightly of topic: we are dealing with 18 orders of magnitude&lt;/p&gt;
&lt;p&gt;page 312: wake functions = causal functions; here i do not understand enough
physics, isn't the field also present in front of the bunch? or is this
valid only for ultra-relativistic bunches?&lt;/p&gt;
&lt;h1&gt;Chapter 13&lt;/h1&gt;
&lt;p&gt;page 346: three types of motion, three different time scales: longitudinal osc,
transversal osc and closed orbit errors&lt;/p&gt;
&lt;p&gt;page 349: Fig 13.2 (SSRL) --&amp;gt; feedback too slow to suppres 60 Hz and harmonics&lt;/p&gt;
&lt;p&gt;page 351: phBPM: gap few times RMS of the beam&lt;/p&gt;
&lt;p&gt;page 353: a mention of feedback simulation, no references given&lt;/p&gt;
&lt;p&gt;page 358: Z transform: http://techteach.no/publications/discretetime_signals_systems/discrete.pdf&lt;/p&gt;
&lt;p&gt;page 358: "beyond the Nyquist freq" --&amp;gt; not entirely true, undersampling is
possible&lt;/p&gt;
&lt;p&gt;page 362: MIMO, check:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ref 19&lt;/li&gt;
&lt;li&gt;ref 20&lt;/li&gt;
&lt;li&gt;ref 21&lt;/li&gt;
&lt;li&gt;ref 22&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Chapter 14 and 15&lt;/h1&gt;
&lt;p&gt;no relevant notes&lt;/p&gt;
&lt;h1&gt;Chapter 16&lt;/h1&gt;
&lt;p&gt;page 432: "safety is a part of doing things"&lt;/p&gt;
&lt;p&gt;page 435: general observation: unreliable safety feature (i.e. interlock) will
increase the danger&lt;/p&gt;
&lt;p&gt;page 440: "The OPCOs have [...] the authority to stop any activity where safety
[...] is in question" - everybody has (or should have) the Stop Work Authority&lt;/p&gt;
&lt;p&gt;page 448: tungsten --&amp;gt; impossible to melt with beam&lt;/p&gt;
&lt;p&gt;page 456: interlock testing: each input --&amp;gt; response&lt;/p&gt;
&lt;p&gt;page 457: for PLCs the standard for functional safety (IEC 61508) should be
mentioned. The standard was first published in 1998, while the book is from
1994.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content></entry><entry><title>New Ubuntu, old problems with ModelSim</title><link href="www.j-marjanovic.io/new-ubuntu-old-problems-with-modelsim.html" rel="alternate"></link><published>2019-04-20T08:40:00+02:00</published><updated>2019-04-20T08:40:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2019-04-20:www.j-marjanovic.io/new-ubuntu-old-problems-with-modelsim.html</id><summary type="html">&lt;p&gt;A couple of days ago a new release of Ubuntu, Ubuntu 19.04 Disco Dingo was
released. On my personal laptop I follow the non-LTS line, which brings
me cool features and updated programs (e.g. Python 3.7, GCC 8.3, ...)
out-of-the-box.&lt;/p&gt;
&lt;p&gt;Unfortunately, because the libraries are updated, the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;A couple of days ago a new release of Ubuntu, Ubuntu 19.04 Disco Dingo was
released. On my personal laptop I follow the non-LTS line, which brings
me cool features and updated programs (e.g. Python 3.7, GCC 8.3, ...)
out-of-the-box.&lt;/p&gt;
&lt;p&gt;Unfortunately, because the libraries are updated, the update process causes
some programs to become broken. Mentor Graphics ModelSim is for example
one of the tools which required some tweaks to make it work on Ubuntu 19.04.&lt;/p&gt;
&lt;p&gt;Described here are the steps which made ModelSim to work on Ubuntu 19.04.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Please note: according to &lt;a href="https://www.intel.com/content/dam/www/programmable/us/en/pdfs/literature/manual/quartus_install.pdf"&gt;Intel® FPGA Software Installation and
Licensing&lt;/a&gt;,
ModelSim - Intel FPGA Edition officially supports RHEL 5, 6 or 7 and Windows.
Ubuntu is officially not supported.&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Initial attempt&lt;/h1&gt;
&lt;p&gt;I have started with a fresh installation of ModelSim*-Intel® FPGA Starter
Edition Software from Quartus 19.1 package.&lt;/p&gt;
&lt;p&gt;When running &lt;code&gt;vsim&lt;/code&gt; from &lt;code&gt;intelFPGA/19.1/modelsim_ase/bin&lt;/code&gt; I get the
following error message:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./vsim
Error: cannot find &lt;span class="s2"&gt;&amp;quot;./../linux_rh60/vsim&amp;quot;&lt;/span&gt;
$
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;From the path it is clear that ModelSim thinks it is running on RHEL 6. As
described in an extensive &lt;a href="https://wiki.archlinux.org/index.php/Altera_Design_Software#ModelSim-Altera_Edition"&gt;Wiki entry on Altera
software on Arch Linux Wiki&lt;/a&gt;,
one needs to modify &lt;code&gt;vco&lt;/code&gt; file and downgrade &lt;code&gt;freetype&lt;/code&gt; library.&lt;/p&gt;
&lt;p&gt;Once this is settles (by the way, this used to be enough to make ModelSim work on
Ubuntu 18.10) we get the following error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./vsim
Reading pref.tcl
./../linuxaloem/vish: symbol lookup error: /usr/lib/i386-linux-gnu/libfontconfig.so.1: undefined symbol: FT_Done_MM_Var
** Fatal: Read failure in vlm process &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;,0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This message is new and it required me to do some investigation to get it fixed.&lt;/p&gt;
&lt;h1&gt;Downgrading fontconfig&lt;/h1&gt;
&lt;p&gt;From the error message it is clear that &lt;code&gt;libfontconfig.so&lt;/code&gt; tries to use function
called &lt;code&gt;FT_Done_MM_Var&lt;/code&gt; and is unable to find it.&lt;/p&gt;
&lt;p&gt;To investigate further I cloned &lt;code&gt;fontconfig&lt;/code&gt; source code from:
https://gitlab.freedesktop.org/fontconfig/fontconfig.git&lt;/p&gt;
&lt;p&gt;A quick &lt;code&gt;grep&lt;/code&gt; finds the following instances of the symbol in question:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ grep -rn FT_Done_MM_Var .
./README:119:      Use FT_Done_MM_Var &lt;span class="k"&gt;if&lt;/span&gt; available
./src/fcfreetype.c:2261:    FT_Done_MM_Var &lt;span class="o"&gt;(&lt;/span&gt;ftLibrary, mm_var&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
./configure.ac:321:AC_CHECK_FUNCS&lt;span class="o"&gt;(&lt;/span&gt;FT_Get_BDF_Property FT_Get_PS_Font_Info FT_Has_PS_Glyph_Names FT_Get_X11_Font_Format FT_Done_MM_Var&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;One &lt;code&gt;git blame&lt;/code&gt; after we find the following commit which introduced this function:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;commit 94683a1255c065a7f8e7fadee9de605f3eaf9ac7
Author: Behdad Esfahbod &amp;lt;behdad@behdad.org&amp;gt;
Date:   Mon Jan 8 09:55:41 2018 +0000

    Use FT_Done_MM_Var if available
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And then we can find out that release &lt;strong&gt;2.12.92&lt;/strong&gt; is the last one which does
not contain this change.&lt;/p&gt;
&lt;p&gt;I checked out the code from release &lt;strong&gt;2.12.92&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git checkout -b 2.12.92 2.12.92
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Installed the libraries needed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt install libxml2-dev:i386 uuid-dev:i386
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And used the following commands to compile and install an older version
of &lt;code&gt;fontconfig&lt;/code&gt; library:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;aclocal -I m4
autoconf
libtoolize
./autogen.sh
CFLAGS=-m32 LDFLAGS=-L/home/jan/local/packages/freetype-2.4.7-32bit/lib ./configure --prefix=/home/jan/local/packages/fontconfig-2.12.92-32bit --enable-libxml2
make
make install
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Changes to vco&lt;/h1&gt;
&lt;p&gt;Finally, I needed to change &lt;code&gt;vco&lt;/code&gt; in &lt;code&gt;intelFPGA/19.1/modelsim_ase/bin&lt;/code&gt; folder
to load the freshly-recompiled libraries:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="s s-Atom"&gt;diff&lt;/span&gt; &lt;span class="s s-Atom"&gt;vco&lt;/span&gt; &lt;span class="s s-Atom"&gt;vco&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="s s-Atom"&gt;orig&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="s s-Atom"&gt;d10&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s s-Atom"&gt;#&lt;/span&gt; &lt;span class="s s-Atom"&gt;added&lt;/span&gt; &lt;span class="s s-Atom"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;Ubuntu&lt;/span&gt; &lt;span class="mf"&gt;19.04&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt; &lt;span class="s s-Atom"&gt;recompiled&lt;/span&gt; &lt;span class="s s-Atom"&gt;libraries&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;=/home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;jan&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;packages&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;freetype&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.4.7&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="s s-Atom"&gt;bit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nn"&gt;lib&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;jan&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;packages&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;fontconfig&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.12.92&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="s s-Atom"&gt;bit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nn"&gt;lib&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; 
&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="s s-Atom"&gt;c13&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s s-Atom"&gt;#&lt;/span&gt; &lt;span class="s s-Atom"&gt;changed&lt;/span&gt; &lt;span class="s s-Atom"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;Ubuntu&lt;/span&gt; &lt;span class="mf"&gt;19.04&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt; &lt;span class="s s-Atom"&gt;force&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="s s-Atom"&gt;bit&lt;/span&gt; &lt;span class="s s-Atom"&gt;mode&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s s-Atom"&gt;mode=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;MTI_VCO_MODE&lt;/span&gt;&lt;span class="p"&gt;:-&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;32&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="s s-Atom"&gt;---&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s s-Atom"&gt;mode=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;MTI_VCO_MODE&lt;/span&gt;&lt;span class="p"&gt;:-&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="mi"&gt;213&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;214&lt;/span&gt;&lt;span class="s s-Atom"&gt;d208&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;           &lt;span class="s s-Atom"&gt;#&lt;/span&gt; &lt;span class="s s-Atom"&gt;added&lt;/span&gt; &lt;span class="s s-Atom"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;Ubuntu&lt;/span&gt; &lt;span class="mf"&gt;19.04&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt; &lt;span class="s s-Atom"&gt;if&lt;/span&gt; &lt;span class="s s-Atom"&gt;kernel&lt;/span&gt; &lt;span class="s s-Atom"&gt;version&lt;/span&gt; &lt;span class="mf"&gt;5.&lt;/span&gt;&lt;span class="s s-Atom"&gt;x&lt;/span&gt; &lt;span class="s s-Atom"&gt;then&lt;/span&gt; &lt;span class="s s-Atom"&gt;use&lt;/span&gt; &lt;span class="s s-Atom"&gt;linuxaloem&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;           &lt;span class="mf"&gt;5.&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="s s-Atom"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;         &lt;span class="s s-Atom"&gt;vco=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;linuxaloem&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Ta-da, ModelSim now works on Ubuntu 19.04. The font styles are a little bit
broken, but being humble is a good characteristic, and we won't ask too much.&lt;/p&gt;
&lt;p style="width:80%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="ModelSim up and running" src="www.j-marjanovic.io/images/modelsim_on_ubuntu19-04.png"&gt;&lt;/p&gt;</content><category term="FPGA"></category><category term="ModelSim"></category></entry><entry><title>Notes from FOSDEM 2019</title><link href="www.j-marjanovic.io/notes-from-fosdem-2019.html" rel="alternate"></link><published>2019-02-03T20:10:00+01:00</published><updated>2019-02-03T20:10:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2019-02-03:www.j-marjanovic.io/notes-from-fosdem-2019.html</id><summary type="html">&lt;p&gt;I attended FOSDEM 2019 in Brussels:&lt;/p&gt;
&lt;p style="width:40%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Brussels" src="www.j-marjanovic.io/images/fosdem2019.jpg"&gt;&lt;/p&gt;
&lt;p&gt;and these are my notes from Quantum Computers, CAD and Open Hardware
and Python tracks:&lt;/p&gt;
&lt;h1&gt;Quantum Computing&lt;/h1&gt;
&lt;h2&gt;Delivering Practical Quantum Computing on the D-Wave System&lt;/h2&gt;
&lt;h3&gt;Intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;marketing slide for D-Wave Leap&lt;/li&gt;
&lt;li&gt;practical = Adiabatic Quantum computer&lt;/li&gt;
&lt;li&gt;Riggeti uses gate model instead&lt;/li&gt;
&lt;li&gt;physical impl: 3 m …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;I attended FOSDEM 2019 in Brussels:&lt;/p&gt;
&lt;p style="width:40%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Brussels" src="www.j-marjanovic.io/images/fosdem2019.jpg"&gt;&lt;/p&gt;
&lt;p&gt;and these are my notes from Quantum Computers, CAD and Open Hardware
and Python tracks:&lt;/p&gt;
&lt;h1&gt;Quantum Computing&lt;/h1&gt;
&lt;h2&gt;Delivering Practical Quantum Computing on the D-Wave System&lt;/h2&gt;
&lt;h3&gt;Intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;marketing slide for D-Wave Leap&lt;/li&gt;
&lt;li&gt;practical = Adiabatic Quantum computer&lt;/li&gt;
&lt;li&gt;Riggeti uses gate model instead&lt;/li&gt;
&lt;li&gt;physical impl: 3 m high box + 3 normal racks&lt;/li&gt;
&lt;li&gt;QPU (Quantum Processor Unit): 16x16 grid&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;theory&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;language&lt;ul&gt;
&lt;li&gt;qubit&lt;/li&gt;
&lt;li&gt;coupler (either both in same direction or opposite)&lt;/li&gt;
&lt;li&gt;weights (? initial state)&lt;/li&gt;
&lt;li&gt;strength (for couplers)&lt;/li&gt;
&lt;li&gt;objective (function which gets minimized)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;BQM (?)&lt;/li&gt;
&lt;li&gt;5 us annealing&lt;/li&gt;
&lt;li&gt;problems: noise&lt;/li&gt;
&lt;li&gt;noise can bring you in more than one solution (might be useful for some problems)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Markets&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;portfolio&lt;/li&gt;
&lt;li&gt;internet ad&lt;/li&gt;
&lt;li&gt;high-energy physics&lt;/li&gt;
&lt;li&gt;image recognition&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Q &amp;amp; A&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;clock speed -&amp;gt; no clock speed&lt;/li&gt;
&lt;li&gt;total computation time -&amp;gt; 5 us to 1 s&lt;/li&gt;
&lt;li&gt;Pegasus: proposed arch for a new machine&lt;/li&gt;
&lt;li&gt;new Hamiltonioan in Pegasus&lt;/li&gt;
&lt;li&gt;error corrections: from 2048 bits, no error corrections because of what
  they calculate&lt;/li&gt;
&lt;li&gt;classical solutions vs quantum solutions: wall-clock time is the benchmark&lt;/li&gt;
&lt;li&gt;hello world: &lt;/li&gt;
&lt;li&gt;D-Wave: not a threat for a normal crypto (factoring a number is not a good problem)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;D-Wave's Software Development Kit&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;tools and utilities for QC development&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;motivation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;solution space is "smooth": good solutions are "grouped together"&lt;/li&gt;
&lt;li&gt;step 1: problem as polynomial&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;equation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;b-terms: linear bias&lt;/li&gt;
&lt;li&gt;a-terms: quadratic bias&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Quantum Machine Instr: biases in certain range: because of physical limitaiton?
* Chimera graph and Pegasus graph&lt;/p&gt;
&lt;h3&gt;Ocean software&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Python front-end, C++ for high performance&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mapping methods&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;samplers&lt;/li&gt;
&lt;li&gt;compute resources&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;dimod&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;API for samplers&lt;/li&gt;
&lt;li&gt;BQM&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;cloud client&lt;/h4&gt;
&lt;h4&gt;minorminer&lt;/h4&gt;
&lt;h4&gt;dwavebinaryscp&lt;/h4&gt;
&lt;p&gt;constraint satisfaction&lt;/p&gt;
&lt;h4&gt;dwave-networkx&lt;/h4&gt;
&lt;p&gt;graph theory problem,
same API as networkx&lt;/p&gt;
&lt;h3&gt;Steps&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;translate to binary&lt;/li&gt;
&lt;li&gt;define BQM function&lt;/li&gt;
&lt;li&gt;BQM to matrix form&lt;/li&gt;
&lt;li&gt;BQM through sampler&lt;/li&gt;
&lt;li&gt;post-processing and interpretation&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;pip install dwave-ocean-sdk&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;Q &amp;amp; A&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;resolution: 0.01 resolution&lt;/li&gt;
&lt;li&gt;Fujitsu and Hitachi: another providers&lt;/li&gt;
&lt;li&gt;8 couplers per qbit&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;D-Wave Hybrid Framework&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;decomposition -&amp;gt; split the problem to fit into BQM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;github.com/dwavesystems/dwave-hybrid&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;solver/sampler framework&lt;/li&gt;
&lt;li&gt;uses both quantum and classical resources&lt;/li&gt;
&lt;li&gt;dataflow paradigm&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;What is IBMQ&lt;/h2&gt;
&lt;h3&gt;quantum algorithms&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;current algorithms --&amp;gt; quantum algorithms&lt;/li&gt;
&lt;li&gt;supra-polynomial speed-up&lt;/li&gt;
&lt;li&gt;Schor's algorithm: polynomial time for factoring of the numbers&lt;/li&gt;
&lt;li&gt;simulating quantum mechanics (Hamiltonian equations); for chemistry&lt;/li&gt;
&lt;li&gt;factoring 1024-bit number: hours with QC&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;how to program a QC: mapping interference pattern on qbits&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;entanglement -&amp;gt; consistent quantum system -&amp;gt; colapse&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;every quantum program: circuit (no feedback!)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;result is non deterministic (robust algorithms provide good results)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;quantum volume (metric used at IBM)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;coherence time: 100s of us&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;technology is quantum ready&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;quantum technologies&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;superconductive Josephson junction&lt;/li&gt;
&lt;li&gt;entaglion (only hypothetical?)&lt;/li&gt;
&lt;li&gt;QASM (quantum assembly language)&lt;/li&gt;
&lt;li&gt;5 GHz, 240 mK, low noise&lt;/li&gt;
&lt;li&gt;all QC look similar: only way to do it&lt;/li&gt;
&lt;li&gt;current state: oscilloscopes, signal generators, ...&lt;/li&gt;
&lt;li&gt;pizza box for controlling the QC in the future&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;quantum advantage&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;IBM provides a lot of stuff on their GitHub&lt;/li&gt;
&lt;li&gt;Jupyter notebooks, vscode plugin&lt;/li&gt;
&lt;li&gt;Quiskit Acua: example problem: bonding energy for a molecule &lt;/li&gt;
&lt;li&gt;Quiskit Aer: ...&lt;/li&gt;
&lt;li&gt;publicly available QC&lt;/li&gt;
&lt;li&gt;gate error and readout error are publicly available (~1e-3 for the example)&lt;/li&gt;
&lt;li&gt;IBM has several QC architectures (Tokyo, Melburne)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Q &amp;amp; A&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;noise problems for QC, do qbits produce noise -&amp;gt; engineering will find a solution&lt;/li&gt;
&lt;li&gt;quantum volue of Tokyo -&amp;gt; "the best, it is not just the number of qbits"&lt;/li&gt;
&lt;li&gt;Quiskit Aqua: chemistry API&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;CAD and Open Hardware&lt;/h1&gt;
&lt;h2&gt;gnucap&lt;/h2&gt;
&lt;h3&gt;intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;mixed-signal simulator&lt;/li&gt;
&lt;li&gt;prototype for Verilog-AMS (~10 years ago)&lt;/li&gt;
&lt;li&gt;analog circuits and digital circuits simulators are different (transient vs event-based)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;analog circuit simulation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;node equations --&amp;gt; matrix form&lt;/li&gt;
&lt;li&gt;often: differential equations, Newton iteration&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;digital circuit simulation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;event based, with evaluation queue&lt;/li&gt;
&lt;li&gt;can be used&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Gnucap&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Gnucap decompose the circuit matrix into L and U&lt;/li&gt;
&lt;li&gt;Gnucap keeps track of the changes to the matrix, schedules an update to
  the circuit matrix &lt;/li&gt;
&lt;li&gt;bypass = not computing something&lt;/li&gt;
&lt;li&gt;Gnucap uses all the tricks to calculate inverse of the matrix (pivoting)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;architecture of Gnucap&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;the concept (matrix solving + event-based updates) is tighly integrated
  in the codebase&lt;/li&gt;
&lt;li&gt;plugin infrasctructure: modeling languages (VHDL, Verilog-AMS, SystemC considered)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;shared library for basic s&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;compoenents are plugins (dlopen)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;components&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;commands&lt;/li&gt;
&lt;li&gt;algorithms &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;plugins&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Turing complete&lt;/li&gt;
&lt;li&gt;examples of plugins&lt;/li&gt;
&lt;li&gt;import module (python)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;insmod module (linux)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;gnucap-python&lt;/code&gt;, e.g. Jupyter, user can access internal data, use Scipy, ...&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Verilog-A in QUCS/gnucsator&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;license for models&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Gnucap supports models from other sources&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;two types:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;distributed as source code: --&amp;gt; just log it into the Gnucap (no issues)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;distributed as binary: --&amp;gt; wrapper + blob&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;summary&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;mixed-mode is faster&lt;/li&gt;
&lt;li&gt;more front-end work needed&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ngspice&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;talk is not about the details, but about the framework, user interface and future&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;input: standard SPICE text inpu&lt;/li&gt;
&lt;li&gt;output: transient simulator &lt;/li&gt;
&lt;li&gt;
&lt;p&gt;successor of spice3f5 from Berkley&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;three flavors:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;standard executable: CLI, file and graphics output, control language&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;shared library for tcl/tk (not used so much)&lt;/li&gt;
&lt;li&gt;C shared library (so/dll): input and output via callbacks&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;scripting language&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;its own library (developer don't like python)&lt;/li&gt;
&lt;li&gt;94 commands, math functions, loops, ...&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;device models&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;hard-coded models (BJS, MOS, JFET, xFET, trans lines, Verilog A interface via adms)&lt;/li&gt;
&lt;li&gt;B source with build-in function&lt;/li&gt;
&lt;li&gt;XSPICE shared library (written in C, both analog and digital)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;application areas&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;PCB design&lt;/li&gt;
&lt;li&gt;mix of ICs and discrete components&lt;/li&gt;
&lt;li&gt;requires a comfortable user interface (offered by 3rd parties - e.g. KiCAD)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PSPICE and LTSPICE model requirements&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IC design&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;models from the foundries (very reliable but complex)&lt;/li&gt;
&lt;li&gt;supports HSPICE&lt;/li&gt;
&lt;li&gt;MOS models, large circuits, certain speed&lt;/li&gt;
&lt;li&gt;integration with other tools ongoing&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;mixed-signal capabilities&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;from XSPICE&lt;/li&gt;
&lt;li&gt;digital: event based, signal strengths and delays&lt;/li&gt;
&lt;li&gt;analog: C coded models, time and freq domain&lt;/li&gt;
&lt;li&gt;simple example: digital is 50x faster than analog&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;experimental developments&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;KLU solver: 2x, 3x faster&lt;/li&gt;
&lt;li&gt;CUDA for GPU: development on-going&lt;/li&gt;
&lt;li&gt;Cider: 1D and 2D TCAD: device structure, solve physics equations&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;licenses&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;core: BSD, LGPL, ... no issues&lt;/li&gt;
&lt;li&gt;Verilog A models: more complicated&lt;/li&gt;
&lt;li&gt;vendor devices: can be used, but not distributed&lt;/li&gt;
&lt;li&gt;IC model data: PDKs are under NDA (also encryption)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;future&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;unicode&lt;/li&gt;
&lt;li&gt;some commands (pz, ...)&lt;/li&gt;
&lt;li&gt;integration with other tools and flows&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;openEMS - An Introduction and Overview&lt;/h2&gt;
&lt;h3&gt;intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;FOSS solver for electromagnetics fields&lt;/li&gt;
&lt;li&gt;simulate and evaluate RF and optical devices&lt;/li&gt;
&lt;li&gt;uses FDTD (finite differences in time domain)&lt;/li&gt;
&lt;li&gt;co-ordinate systems: cylindrial and cartesian&lt;/li&gt;
&lt;li&gt;lumped elements available&lt;/li&gt;
&lt;li&gt;human body models&lt;/li&gt;
&lt;li&gt;dispersive models&lt;/li&gt;
&lt;li&gt;support for remote simulation (cluster)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;show cases&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;notch filter, very nice demo&lt;/li&gt;
&lt;li&gt;examples: helical antena, antenna array, MRI antenna design (loop coils)&lt;/li&gt;
&lt;li&gt;small size PCB antenna&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;interfacing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;nice to have: interface to PCB editors&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;problem: link (between EMS and PCB editors) is very week&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;some examples:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;hyp2mat&lt;/li&gt;
&lt;li&gt;pcb-rnd&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pcbmodelgen (KiCAD to openEMS)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ultimate goal: Circuit simulation &amp;lt;--&amp;gt; PCB design &amp;lt;--&amp;gt; RF simulation&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;status&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;openEMS is a mature EM simulation package&lt;/li&gt;
&lt;li&gt;TODO list: improve the documentation, interface to tools, ...&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Project Trellis and nextpnr&lt;/h2&gt;
&lt;h3&gt;ECP5&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;85k logic cells (4 LUTS, FF, carry), block RAM, 18x18 DSPs, SERDES (up to 5 GTs)&lt;/li&gt;
&lt;li&gt;split into tiles, tiles split into slices&lt;/li&gt;
&lt;li&gt;fixed wires&lt;/li&gt;
&lt;li&gt;arcs and pip&lt;/li&gt;
&lt;li&gt;all arcs and wires are undirectional - mux topology&lt;/li&gt;
&lt;li&gt;dedicated clock network&lt;/li&gt;
&lt;li&gt;programmable interconnect: pass gates (cascade of 2 mux)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;status&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;bit and routing done&lt;/li&gt;
&lt;li&gt;missing: DSP&lt;/li&gt;
&lt;li&gt;timing documentation for fabric, logic cells, RAM, ...&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;text configuration format&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;tools to convert from and to bitstream&lt;/li&gt;
&lt;li&gt;intermediate format for place &amp;amp; route&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;timing&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;not enought vendor support&lt;/li&gt;
&lt;li&gt;delays for the cells extracted from SDF files&lt;/li&gt;
&lt;li&gt;routing delay obtained using least-squares from reports for entire net&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;workflow&lt;/h3&gt;
&lt;h4&gt;yosys&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;support ECP5, iCE40, Xilinx, ...&lt;/li&gt;
&lt;li&gt;uses Berkley ABC for logic optimization&lt;/li&gt;
&lt;li&gt;formal equivalence checking, assertions&lt;/li&gt;
&lt;li&gt;....&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;nextpnr&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;replacement for arachnepnr&lt;/li&gt;
&lt;li&gt;developments from May 2018&lt;/li&gt;
&lt;li&gt;timing-driven&lt;/li&gt;
&lt;li&gt;architecture implements an API: useful for different architectures&lt;/li&gt;
&lt;li&gt;each arch has its own binary: a lot of optimization possible&lt;/li&gt;
&lt;li&gt;7-series is VERY experimental (more work planned)&lt;/li&gt;
&lt;li&gt;first implementation:&lt;/li&gt;
&lt;li&gt;SA placer&lt;/li&gt;
&lt;li&gt;A*+ripup router&lt;/li&gt;
&lt;li&gt;future&lt;/li&gt;
&lt;li&gt;analyty placer&lt;/li&gt;
&lt;li&gt;SAT-based placer,&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;li&gt;nice graphical interface&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Design Automation in Wonderland&lt;/h2&gt;
&lt;h3&gt;intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;motivation and goals&lt;/li&gt;
&lt;li&gt;reuse common functionality&lt;/li&gt;
&lt;li&gt;easy to integrate, easy to adapt libraries&lt;/li&gt;
&lt;li&gt;a set of modular libraries&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;based on Berkley ABC&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;use C++14 or C++17&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;header-only&lt;/li&gt;
&lt;li&gt;well documented, well tested&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;libraries&lt;/h3&gt;
&lt;h4&gt;lorina: parsing library&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;can pasrse very simple Verilog&lt;/li&gt;
&lt;li&gt;parser reads Verilog and provides data to mockturtle&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;mockturtle: logic network library&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;network interface API&lt;/li&gt;
&lt;li&gt;logic synth, opt, technology mapping&lt;/li&gt;
&lt;li&gt;impelementations: and-inverted, kLUT, ...&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;performance tweeks&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cut the combinatorial network into LUTs, based on cost function (speed/area)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;kitty: truth table&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;manipulation of truth table&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;percy: exact synthesis library&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;re-synthesis&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;conclusion&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;exctract the logic function&lt;/li&gt;
&lt;li&gt;optimization&lt;/li&gt;
&lt;li&gt;mapping to tech&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;github.com/lsils&lt;/p&gt;
&lt;h2&gt;Open source virtual prototyping for faster hardware and software co-design&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;virtual prototyping &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;current development&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;idea&lt;/li&gt;
&lt;li&gt;SW and HW developed in parallel&lt;/li&gt;
&lt;li&gt;integration&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;virtual prototype&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;idea&lt;/li&gt;
&lt;li&gt;virtual prototype --&amp;gt; SW can be developed in parallel&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;virtual prototyping: SW environment simulating the HW&lt;/p&gt;
&lt;h3&gt;example&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;model entire SoC (RPi: quad core, peripheral)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;issues:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;models (of the IP) are hard to find&lt;/li&gt;
&lt;li&gt;too much components --&amp;gt; needs to be done: shared effort&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;?&lt;/h3&gt;
&lt;p&gt;"interoperability is the key" --&amp;gt; take advantage of the community&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;toolchain: marketplace for components, GUI, ...&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Q &amp;amp; A&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;interface with SystemC and TLM: support for TLM is there&lt;/li&gt;
&lt;li&gt;modules: how to verify the model: ?&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Lesson learned from Retro-uC and search for ideal HDL for open source silicon&lt;/h2&gt;
&lt;h3&gt;intro&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;idea: open source microcontroller (Z80, MOS 65 and 68000, 3 uC in one chip)&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;a development board&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;"VHDL and Verilog are not the right tools for the job"&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;RTL faults&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;clock is logic signal&lt;/li&gt;
&lt;li&gt;if --&amp;gt; mux or flip-flop&lt;/li&gt;
&lt;li&gt;synth vs non-synth&lt;/li&gt;
&lt;li&gt;Verilog: block and non-blocking&lt;/li&gt;
&lt;li&gt;FPGA vs ASIC&lt;/li&gt;
&lt;li&gt;RTFLRM&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;improvements&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;signed&lt;/li&gt;
&lt;li&gt;process(all)&lt;/li&gt;
&lt;li&gt;generate&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;"putting a lipstick on a pig"&lt;/p&gt;
&lt;h3&gt;new developments&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;TL-Verilog&lt;/li&gt;
&lt;li&gt;SystemC/TLM&lt;/li&gt;
&lt;li&gt;"good tools are proprierty" (Vivado HLS, Catapult)&lt;/li&gt;
&lt;li&gt;Panda Bamboo&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GAUT (gaut.fr)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyHDL&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Chisel/SpinalHDL --&amp;gt; "going in the right direction" --&amp;gt; first need to learn Scala&lt;/li&gt;
&lt;li&gt;Migen/MiSoc/nmigen --&amp;gt; prefered by the speaker&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Python&lt;/h1&gt;
&lt;h2&gt;CPython Memory Management&lt;/h2&gt;
&lt;h3&gt;motivation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;what user needs to know&lt;/li&gt;
&lt;li&gt;learn how to control (gc, sys.getrefcount)&lt;/li&gt;
&lt;li&gt;memory leaks &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;allocation of memory&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;CPython has PyObject for everything&lt;/li&gt;
&lt;li&gt;size: obj size &amp;lt; 512 bytes --&amp;gt; small, ele big&lt;/li&gt;
&lt;li&gt;big objects: system allocator&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;small object: 3 levels, pools and arena&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;8-byte alignment --&amp;gt; size idx: size / 8 - 1&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;pools&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;4k size, objects of same size&lt;/li&gt;
&lt;li&gt;blocks &lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;arenas&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;encapsulate pools&lt;/li&gt;
&lt;li&gt;containts 64 pools&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;object specificts&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;string interning (simple string)&lt;/li&gt;
&lt;li&gt;small integers (-5 to 256)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;garbage collection&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;reference counting&lt;/li&gt;
&lt;li&gt;easy to find unused obj&lt;/li&gt;
&lt;li&gt;no marking&lt;/li&gt;
&lt;li&gt;memory overhead&lt;/li&gt;
&lt;li&gt;no cyclical references&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;tools in python&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;two modules: gc and tracemalloc&lt;/li&gt;
&lt;li&gt;plus: sys._debugmallocstats()&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;That's all folks, 'till next year!&lt;/em&gt;&lt;/p&gt;</content><category term="Quantum computers"></category><category term="Open Hardware"></category><category term="Chisel"></category></entry><entry><title>Chisel tester with overridden step() method</title><link href="www.j-marjanovic.io/chisel-tester-with-overridden-step-method.html" rel="alternate"></link><published>2018-10-14T21:00:00+02:00</published><updated>2018-10-14T21:00:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2018-10-14:www.j-marjanovic.io/chisel-tester-with-overridden-step-method.html</id><summary type="html">&lt;h1&gt;Introduction&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://chisel.eecs.berkeley.edu/"&gt;Chisel&lt;/a&gt; is a modern take on Hardware
Description Languages, such as (System)Verilog and VHDL. Both Verilog and VHDL
were conceived in 80s, and are currently still the main two options when it
comes to describing hardware. From the Developer Experience point-of-view, I
would say that both languages are …&lt;/p&gt;</summary><content type="html">&lt;h1&gt;Introduction&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://chisel.eecs.berkeley.edu/"&gt;Chisel&lt;/a&gt; is a modern take on Hardware
Description Languages, such as (System)Verilog and VHDL. Both Verilog and VHDL
were conceived in 80s, and are currently still the main two options when it
comes to describing hardware. From the Developer Experience point-of-view, I
would say that both languages are kind of OK once one gets used to them.&lt;/p&gt;
&lt;h1&gt;Short comparison to VHDL and Verilog&lt;/h1&gt;
&lt;p&gt;Obviously there are still areas where this two languages could be improved. That
is why I have started to experiment with Chisel in my free time. The modules
written in Chisel are shorter and thus more readable. &lt;/p&gt;
&lt;h2&gt;Verbosity&lt;/h2&gt;
&lt;p&gt;Having one implicit clock domain is (in most cases) great, and everything is
then clocked from this clock. This saves a lot of typing compared to the
Verilog:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;always&lt;/span&gt; &lt;span class="p"&gt;@(&lt;/span&gt;&lt;span class="k"&gt;posedge&lt;/span&gt; &lt;span class="n"&gt;clk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;begin&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;proc_smth&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;reset&lt;/span&gt; &lt;span class="k"&gt;begin&lt;/span&gt;
    &lt;span class="c1"&gt;// reset logic&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;begin&lt;/span&gt;
    &lt;span class="c1"&gt;// here comes the real useful stuff&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and VHDL:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nc"&gt;proc_smth&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;process&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;begin&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;rising_edge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;reset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
      &lt;span class="c1"&gt;-- reset logic&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="c1"&gt;-- here comes the real useful stuff&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="k"&gt;process&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I would argue that half of the lines in a typical VHDL modules are not needed,
as demonstrated in previous example. A typical module for me would be some DSP
or protocol processing module, operating in a single clock domain. For special
cases, where precise control of clocks is needed, such as in ADC interface with
ISERDES, one can still write the "sensitive" parts in classic HDL.&lt;/p&gt;
&lt;h2&gt;Development tools&lt;/h2&gt;
&lt;p&gt;Other advantage of Chisel is: one can use &lt;a href="https://www.jetbrains.com/idea/download/"&gt;IntelliJ IDEA Community
Edition&lt;/a&gt; to write code. Compared even
to the best VHDL/Verilog IDEs, e.g. &lt;a href="https://www.sigasi.com/"&gt;Sigasi&lt;/a&gt;, IntelliJ
is light-years ahead when it comes to refactoring, autocompletion, integration
with Git and countless little helpers.&lt;/p&gt;
&lt;h2&gt;Testing&lt;/h2&gt;
&lt;p&gt;Chisel is based on Scala, and for hardware generation and testing this is a
significant advantage. Chisel provides &lt;code&gt;ChiselFlatSpec&lt;/code&gt; which is based on
&lt;code&gt;FlatSpec&lt;/code&gt; and allows declaring specifications (in style of &lt;code&gt;"Module" should "do
something"&lt;/code&gt;) which are then evaluated.&lt;/p&gt;
&lt;p&gt;One area where Chisel is seriously lacking compared to VHDL and Verilog are
the implementation of the testbenches (or testers in Chisel-speak). In Verilog
and VHDL one can write testbench in a same language with the same constructs
as "Device" Under Test. In Chisel, synthesizable logic is written in Chisel,
while testbenches are written in Scala.&lt;/p&gt;
&lt;h1&gt;Better testbenches&lt;/h1&gt;
&lt;p&gt;If we cannot write the testbenches in same language as logic, let's explore
other options. Chisel itself provides multiple
&lt;a href="https://github.com/freechipsproject/chisel-testers"&gt;testers&lt;/a&gt;, such as
&lt;code&gt;PeekPokeTester&lt;/code&gt;, &lt;code&gt;SteppedHWIOTester&lt;/code&gt; and &lt;code&gt;OrderedDecoupledHWIOTester&lt;/code&gt;. In my
opinion, &lt;code&gt;OrderedDecoupledHWIOTester&lt;/code&gt; and &lt;code&gt;SteppedHWIOTester&lt;/code&gt; are only suitable
for very small modules, and do not provide enough features to sufficiently test
a DSP module with AXI4-Stream input, AXI4-Stream output and AXI4-Lite slave
port for configuration.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PeekPokeTester&lt;/code&gt; allows &lt;code&gt;poke&lt;/code&gt;-ing the inputs to DUT and &lt;code&gt;peek&lt;/code&gt;-ing the outputs
from DUT. It also provides a &lt;code&gt;step()&lt;/code&gt; method to advance simulation time by one
or more clock period.&lt;/p&gt;
&lt;p&gt;In the previously-described case with a DUT with three ports (two AXI4-Stream
and one AXI4-Lite) one would ideally need three separate Bus Functional Models
(BFMs) which get executed (read their inputs and update their outputs) every
clock cycle. This can be achieved by overriding the &lt;code&gt;step()&lt;/code&gt; method of the
&lt;code&gt;PeekPokeTester&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;Overriding &lt;code&gt;step()&lt;/code&gt; method&lt;/h1&gt;
&lt;p&gt;The code for this example is available on my GitHub, in &lt;a href="https://github.com/j-marjanovic/chisel-stuff/tree/master/example-1-override-step"&gt;chisel-stuff/example-1&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this simplified (stripped to the minimum) example, we have a DUT with two
interfaces. Each interface consist only of &lt;code&gt;data&lt;/code&gt; and &lt;code&gt;valid&lt;/code&gt; signals, neither
DUT nor monitor BFM are unable to backpressure the stream of data. The testbench
will consist of three logical units: DUT, Driver BFM and Monitor BFM. Both BFMs
are updated every clock cycles, so that driver BFM can drive the input port of
the DUT and monitor BFM can in parallel monitor the output port of the DUT.&lt;/p&gt;
&lt;p&gt;The core of this examples are the following couple of lines (from &lt;a href="https://github.com/j-marjanovic/chisel-stuff/blob/master/example-1-override-step/src/test/scala/overrideStepExample/OverrideStepExampleTester.scala#L126"&gt;OverrideStepExampleTester.scala:126&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="c1"&gt;//==========================================================================&lt;/span&gt;
  &lt;span class="c1"&gt;// step&lt;/span&gt;

  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;runtimeMirror&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getClass&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getClassLoader&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reflect&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;symbol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;typeSignature&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;bfms&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;_&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;typeSignature&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;:&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;typeOf&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;ChiselBfm&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;stepSingle&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Unit&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bfm&lt;/span&gt; &lt;span class="k"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;bfms&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reflectField&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bfm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asTerm&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asInstanceOf&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;ChiselBfm&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;super&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;override&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Unit&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;_&lt;/span&gt; &lt;span class="k"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;until&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;stepSingle&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Through Scala's &lt;a href="https://www.michaelpollmeier.com/fun-with-scalas-new-reflection-api-2-10"&gt;Reflection API&lt;/a&gt;
we are able to find all instances of classes which have a trait of &lt;code&gt;ChiselBfm&lt;/code&gt;,
and then call their &lt;code&gt;update()&lt;/code&gt; methods. This allows both BFMs to read and write
to the ports as they desire, independent from each other.&lt;/p&gt;
&lt;p&gt;The instantiations of both BFMs is a little clunky, we need to manually provide
them all the methods from &lt;code&gt;PeekPokeTester&lt;/code&gt; which are needed during the
operation of the BFMs.&lt;/p&gt;
&lt;p&gt;Running &lt;code&gt;sbt test&lt;/code&gt; in &lt;code&gt;example-1-override-step&lt;/code&gt;, we obtain the following result:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[info] [0.002] SEED 1539634207505
[info] [0.023]     0 Test starting...
[info] [0.271]     5 Driver: sent 0
[info] [0.274]     6 Driver: sent 1
[info] [0.278]     7 Monitor: received 1
[info] [0.278]     7 Driver: sent 2
[info] [0.289]     8 Monitor: received 2
[info] [0.290]     8 Driver: sent 10
[info] [0.310]     9 Monitor: received 3
[info] [0.310]     9 Driver: sent 99
[info] [0.314]    10 Monitor: received 11
[info] [0.315]    10 Driver: sent 100
[info] [0.324]    11 Monitor: received 100
[info] [0.326]    11 Driver: sent 65534
[info] [0.340]    12 Monitor: received 101
[info] [0.340]    12 Driver: sent 65535
[info] [0.344]    13 Monitor: received 65535
[info] [0.348]    14 Monitor: received 0
[info] [0.401]    23 Test finished.
Enabling waves..
Exit Code: 0
[info] [0.409] RAN 23 CYCLES PASSED
[info] OverrideStepExampleTest:
[info] pipeline tester
[info] - should compare expected and obtained response
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And this is the display of the waveforms from GTKWave:&lt;/p&gt;
&lt;p&gt;&lt;img alt="GTKWave display" src="www.j-marjanovic.io/images/chisel_override_clock.png"&gt;&lt;/p&gt;
&lt;p&gt;It can be noted that both Driver and Monitor are able to perform their tasks
in parallel.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Shown here is a convenient method to enhance the Chisel &lt;code&gt;PeekPokeTester&lt;/code&gt;. In
this particular case (when DUT has only one input and one output port), one
could also use &lt;code&gt;OrderedDecoupledHWIOTester&lt;/code&gt;, but it should be obvious that the
method presented here provides more control and flexibility in more complex
cases.&lt;/p&gt;</content><category term="FPGA"></category><category term="Scala"></category><category term="BFM"></category></entry><entry><title>Blog restart</title><link href="www.j-marjanovic.io/blog-restart.html" rel="alternate"></link><published>2018-09-15T19:00:00+02:00</published><updated>2018-09-15T19:00:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2018-09-15:www.j-marjanovic.io/blog-restart.html</id><summary type="html">&lt;p&gt;This blog was left dormant for quite some time now. From the last blog post
in February 2017 a lot has happened. I have moved to Hamburg, Germany, to
start a new position as FPGA Developer at MicroTCA Technology Lab at
&lt;a href="https://www.desy.de/"&gt;DESY&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is me in European XFEL tunnel:&lt;/p&gt;
&lt;p style="width:70%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Jan in European XFEL tunnel" src="www.j-marjanovic.io/images/jan_at_desy.jpg"&gt;&lt;/p&gt;
&lt;p&gt;There …&lt;/p&gt;</summary><content type="html">&lt;p&gt;This blog was left dormant for quite some time now. From the last blog post
in February 2017 a lot has happened. I have moved to Hamburg, Germany, to
start a new position as FPGA Developer at MicroTCA Technology Lab at
&lt;a href="https://www.desy.de/"&gt;DESY&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is me in European XFEL tunnel:&lt;/p&gt;
&lt;p style="width:70%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Jan in European XFEL tunnel" src="www.j-marjanovic.io/images/jan_at_desy.jpg"&gt;&lt;/p&gt;
&lt;p&gt;There are a couple of topics which I would like to explore as a hobby, and
having a blog is a nice way to organize your thoughts and outputs. Writing a
blog post at the end of the project requires someone to gather his thoughts
and to write down the conclusion.&lt;/p&gt;
&lt;p&gt;That is all for now, expect more interesting blog posts (probably focusing on
FPGA, mid-level languages as Chisel and high-level synthesis) in the future.&lt;/p&gt;</content></entry><entry><title>FOSDEM 2017</title><link href="www.j-marjanovic.io/fosdem-2017.html" rel="alternate"></link><published>2017-02-03T18:00:00+01:00</published><updated>2017-02-03T18:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2017-02-03:www.j-marjanovic.io/fosdem-2017.html</id><summary type="html">&lt;p&gt;I am writing this post from Brussels where I am attending &lt;a href="https://fosdem.org/2017/"&gt;FOSDEM 2017&lt;/a&gt;
conference.&lt;/p&gt;
&lt;p&gt;There are a lot of interesting talks, and sometimes it is quite hard to decide
on which one to go. Luckily there the talks are recorded and one can later
check also the missed ones.&lt;/p&gt;
&lt;p&gt;Here …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I am writing this post from Brussels where I am attending &lt;a href="https://fosdem.org/2017/"&gt;FOSDEM 2017&lt;/a&gt;
conference.&lt;/p&gt;
&lt;p&gt;There are a lot of interesting talks, and sometimes it is quite hard to decide
on which one to go. Luckily there the talks are recorded and one can later
check also the missed ones.&lt;/p&gt;
&lt;p&gt;Here is my list of the talks I plan to attend:&lt;/p&gt;
&lt;h2&gt;Saturday&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Time&lt;/th&gt;
&lt;th&gt;Title&lt;/th&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;9:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/keynotes_welcome/"&gt;Welcome to FOSDEM 2017&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Janson&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/open_power/"&gt;Let's talk about hardware: The POWER of open&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;H.2215 (Ferrer)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/lorawan/"&gt;LoRaWAN for exploring the Internet of Things&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;K.1.105 (La Fontaine)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13:00&lt;/td&gt;
&lt;td&gt;lunch&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/kernel_spi_subsystem/"&gt;Groking the Linux SPI Subsystem&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;UD2.120 (Chavanne)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14:00 (alternative)&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/sdr_fpga/"&gt;FPGAs in SDR -- Why, when, and how to use them (with RFNoC)&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;AW1.120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/hello_world/"&gt;Everything You Always Wanted to Know About "Hello, World"*&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Janson&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16:30&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/iot_micropython/"&gt;Scientific MicroPython for Microcontrollers and IoT&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;AW1.126&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;17:00&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/libreboot/"&gt;Libreboot&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;K.1.105 (La Fontaine)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;18:05&lt;/td&gt;
&lt;td&gt;&lt;a href="https://fosdem.org/2017/schedule/event/copyleft_defense/"&gt;Understanding The Complexity of Copyleft Defense&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Janson&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Sunday&lt;/h2&gt;
&lt;p&gt;On Sunday I plan to spend most of the time in &lt;a href="https://fosdem.org/2017/schedule/track/electronic_design_automation_eda/"&gt;Electronic Design Automation (EDA) devroom&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here is a selfie of me with the famous &lt;a href="https://en.wikipedia.org/wiki/Manneken_Pis"&gt;Manneken Pis status&lt;/a&gt;:&lt;/p&gt;
&lt;p style="width:50%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Selfie with Manneken Pis" src="www.j-marjanovic.io/images/fosdem_2017/IMG_4898.JPG"&gt;&lt;/p&gt;</content><category term="Conference"></category></entry><entry><title>Books read: E. Stavinov: 100 Power Tips for FPGA Designers</title><link href="www.j-marjanovic.io/books-read-e-stavinov-100-power-tips-for-fpga-designers.html" rel="alternate"></link><published>2016-10-18T23:00:00+02:00</published><updated>2016-10-18T23:00:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2016-10-18:www.j-marjanovic.io/books-read-e-stavinov-100-power-tips-for-fpga-designers.html</id><summary type="html">&lt;p&gt;I recently found a great book explaining in details FPGA workflow for Xilinx
tools, titled 100 Power Tips for FPGA Designers. &lt;a href="http://www.outputlogic.com"&gt;Evgeni
Stavinov&lt;/a&gt; is an experienced FPGA designer who
previously worked for Xilinx. It is not evident from the title, but this book
focuses almost entirely on the Xilinx, while …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently found a great book explaining in details FPGA workflow for Xilinx
tools, titled 100 Power Tips for FPGA Designers. &lt;a href="http://www.outputlogic.com"&gt;Evgeni
Stavinov&lt;/a&gt; is an experienced FPGA designer who
previously worked for Xilinx. It is not evident from the title, but this book
focuses almost entirely on the Xilinx, while Altera, Lattice and Microsemi are
mentioned just briefly in an FPGA vendor list and every once in a while. Due
to a fast-paced development of the FPGAs and corresponding tools, it is clear
that a book from 2011 would be slightly outdated in 2016. Most notable change
in the previous years was a new software suite from Xilinx, called Vivado and
the slow introduction of C-to-FPGA tools, such as Vivado HLS.&lt;/p&gt;
&lt;p style="width:70%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Evgeni Stavinov: 100 Power Tips for FPGA Designers" src="www.j-marjanovic.io/images/100_power_tips_fpga_designers.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Nonetheless, this book is ideal for somebody who already has some (formal)
education about the FPGA but lacks the real world experience. The author
manages to touch every aspect of the FPGA design, from device selection,
simulation, coding, debugging, communication protocols, FPGA board bring-up
and all small details one should know about FPGAs.&lt;/p&gt;
&lt;p&gt;The book (as the title suggest is organized into 100 tips). Here are my
notes and comments to some tips this book provides.&lt;/p&gt;
&lt;h3&gt;Tip 9&lt;/h3&gt;
&lt;p&gt;The FPGA field has seen some new tools emerge in the past few years, while
some other tools ceased to exist or were integrated in other software suites.
Under &lt;strong&gt;Lint tools&lt;/strong&gt; should definitely be added &lt;em&gt;Sigasi Editor&lt;/em&gt;, an Eclipse
based editor for VHDL and Verilog. &lt;strong&gt;Verilator&lt;/strong&gt; is a cycle based simulator,
since it can be used as a linter (&lt;code&gt;--lint-only&lt;/code&gt;) it should be also added on
this list.&lt;/p&gt;
&lt;p&gt;Another interesting tool worth mentioning is &lt;strong&gt;Doxygen&lt;/strong&gt; which can create the
documentation from the comments in the code and other Markdown documents. The
original program does not support Verilog, but there is a fork &lt;strong&gt;Doxverilog&lt;/strong&gt;
which also adds a support for Verilog.&lt;/p&gt;
&lt;h3&gt;Tip 15&lt;/h3&gt;
&lt;p&gt;This tip states that &lt;code&gt;initial&lt;/code&gt; block are ignored by FPGA synthesis tools. This
probably a feature which was added after the release of the book, but both XST
in ISE 14.7
(http://www.xilinx.com/support/documentation/sw_manuals/xilinx14_7/xst.pdf)
and Vivado Synthesis
(http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug901-vivado-synthesis.pdf)
now support initialization of the register from &lt;code&gt;initial&lt;/code&gt; block.&lt;/p&gt;
&lt;p&gt;Vivado Synthesis Guidelines go even further and suggest using &lt;code&gt;inital&lt;/code&gt; instead
of reset:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Avoid operational set/reset logic whenever possible. There may be other,
less expensive, ways to achieve the desired effect, such as taking
advantage of the circuit global reset by defining an initial content.
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Tip #18&lt;/h2&gt;
&lt;p&gt;A small typo on page 81, in SystemVerilog &lt;code&gt;logic&lt;/code&gt; is a 4-state type which
should replace &lt;code&gt;reg&lt;/code&gt;, especcialy in cases in which &lt;code&gt;reg&lt;/code&gt; keyword may cause a
confusion (e.g. &lt;code&gt;always_comb&lt;/code&gt; block).&lt;/p&gt;
&lt;h2&gt;Tip #19&lt;/h2&gt;
&lt;p&gt;While mentioning code editors for Verilog and VHDL it should be worth
mentioning that the one integrated in Xilinx and Altera tools are complete
garbage. Vivado did not even had a auto-complete until 2016!&lt;/p&gt;
&lt;p&gt;The list of code editors could also be extended with &lt;strong&gt;Sublime Text&lt;/strong&gt; and
&lt;strong&gt;Atom Editor&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Tip #22&lt;/h2&gt;
&lt;p&gt;This tip discusses meta-stability and data-coherency on clock-domain crossing
logic. It would probably be a good idea to also mention how to proceed when a
state machine transitions are controlled with asynchronous signals. This is
similar problem to data coherency, all input signals should be re-sampled to
the state machine clock domain before they are connected to state-transition
logic. Otherwise it is possible for state machine to enter illegal states due
to different delays from IO pins to registers.&lt;/p&gt;
&lt;h2&gt;Tip #26&lt;/h2&gt;
&lt;p&gt;A small typo on page 124, the last line of code example for shift registers
should be:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;initial&lt;/span&gt; &lt;span class="n"&gt;shift4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init2&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="mh"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;   &lt;span class="c1"&gt;// result is 8&amp;#39;hE0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that result after shift operation should be 8'hE0 (-32) instead of 8'h0E.&lt;/p&gt;
&lt;h2&gt;Tip #27&lt;/h2&gt;
&lt;p&gt;I was always wondering if a state machine which has a transition from
&lt;code&gt;default&lt;/code&gt; case defined is equivalent to state machine generated with
&lt;code&gt;-safe_implementation&lt;/code&gt; switch.&lt;/p&gt;
&lt;h2&gt;Tip #29&lt;/h2&gt;
&lt;p&gt;I enjoyed the discussion about various reset mechanism. When I stared
developing with FPGAs I always started writing process blocks the same way
(&lt;code&gt;if !reset_n init_regs_to_something else my_logic_here&lt;/code&gt;) not realizing that
often a reset is not needed. This is especially true in data-processing
pipelines.&lt;/p&gt;
&lt;h2&gt;Tip #34&lt;/h2&gt;
&lt;p&gt;When initializing Block RAM I would suggest using &lt;code&gt;readmemb&lt;/code&gt; and &lt;code&gt;readmemh&lt;/code&gt;
system calls instead of proposed Xilinx custom format, since &lt;code&gt;readmemb&lt;/code&gt; and 
&lt;code&gt;readmemh&lt;/code&gt; work also for simulation.&lt;/p&gt;
&lt;h2&gt;Tips #45-#55&lt;/h2&gt;
&lt;p&gt;These tips discuss ASIC prototyping with FPGA, which is not my area of
interest.&lt;/p&gt;
&lt;h2&gt;Tip #61&lt;/h2&gt;
&lt;p&gt;Here it could also be mentioned that Altera offers a free version of ModelSim,
called ModelSim-Altera Starter Edition. Compared to Xilinx ISIM and Vivado
Simulator, the ModelSim-ASE is stripped-down version of a full ModelSim.
Therefore there is a possibility to easily migrate from free to paid version
if the need for additional features (such as code coverage) arises.&lt;/p&gt;
&lt;h2&gt;Tip #62&lt;/h2&gt;
&lt;p&gt;The figure with the basic testbench components it is a good starting point
even for the testbenches which do not use any verification methodology, such
as UVM. Several points of what I consider a good testbench (especially for
non-UVM, handcrafted testbenches):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;There is a main procedure which performs the setup, runs the driver and
monitor and at the end runs the checker.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The setup should be done exactly as software would do it, e.g. if there is
an AXI4-Lite port with configuration and status registers AXI4-Lite Master BFM
should load the configurations settings on that port. Additionally it is also
good to try reading back the configuration values and check them against the
values written.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The driver and the monitor should operate completely asynchronously one
from another. When simulating a module which operates on data stream (e.g. a
DSP module with  AXI-Stream slave port for input and AXI-Stream master port
for output) I like to additionally throttle the output port, to observe how
the module behaves when the upstream module is not able to temporarily keep up
with data flow.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The checker (as the name suggest) checks the data received on the monitor
with the reference implementation. When there is a mismatch between the
received and expected value, the checker should clearly show the received and
expected value (SystemVerilog assertions are a nice way to do this).&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Tip #63&lt;/h2&gt;
&lt;p&gt;The example which shows the delta cycle delays is fantastic and it also
demonstrates that Verilog is very powerful, but also very dangerous language.
The example is also based on two different registers being clocked by two
different clock. If not absolutely necessary I would advise agains using
different clock in the same modules, and to use the FPGA vendor provided FIFOs
for synchronization between clock domains.&lt;/p&gt;
&lt;p&gt;At the end of this tip there is a Verilog code which stores the state name
string in a separated variable. This is one possible source of errors if the
names of states are changed or if new states are added. Much better solution
would be to use SystemVerilog &lt;code&gt;enum&lt;/code&gt;s, which add a little bit of type
strictness to this otherwise type non-strict language.&lt;/p&gt;
&lt;h2&gt;Tip #67&lt;/h2&gt;
&lt;p&gt;I would agree with the observation that the IP, TCP and UDP protocols were not
designed to be implemented in hardware. Most problematic is the position of the
checksum word in packet header, which does not help neither transmitting neither
receiving side. However, &lt;a href="UDP protocol"&gt;https://www.ietf.org/rfc/rfc768.txt&lt;/a&gt;
foresees sending the packets without the checksum calculation, all bits in the
checksum field must be 0. In some cases this may offer an improvement in link
latency (if there is some other method to check the data correctness).&lt;/p&gt;
&lt;h2&gt;Tip #70&lt;/h2&gt;
&lt;p&gt;This tip describes various FPGA interconnect buses. Due to the Xilinx shift
from PowerPC to ARM and with introduction of Vivado, the bus of choice for an
FPGA designer should be one of 3 version of AXI buses, either AXI4, AXI4-Lite
for configuration registers and AXI4-Stream for streaming data.&lt;/p&gt;
&lt;p&gt;Missing on this list is Avalon bus, which is widely used with Altera QSys. There
are two versions (memory-mapped and streaming) and provide a very convenient way
to interface registers to CPU. Only needed signals need to be specified, while
others are automatically added by QSys during the "compilation".&lt;/p&gt;
&lt;h2&gt;Tip #76&lt;/h2&gt;
&lt;p&gt;With the new FPGA family, UltraScale, Xilinx provides a new PCIe DMA
controller (https://www.youtube.com/watch?v=TzzzM97L4HI). This saves a lot of
work to FPGA designers or significantly reduces the price of IPs. By providing
various AXI interfaces the PCIe DMA controller enables easy integration with
Vivado Block Diagrams. The interfaces on PCIe DMA controller are also similar
to the one on embeeded ARM in Zynq FPGAs. Two different form-factors of same
product can be easily develop by using either PCIe DMA or Zynq ARM core. A
tabletop instrument can use a Zynq to run Linux and provide an interface to
the world by touch-screen display or TCP/UDP server. On the other hand, a
mezzanine card based solution (e.g. MicroTCA) can use PCIe DMA to provide a
link to the main CPU in crate.&lt;/p&gt;
&lt;p&gt;Altera also provides similar modules, such as Cyclone V Avalon-MM Interface
(https://www.altera.com/literature/ug/ug_c5_pcie_avmm.pdf).&lt;/p&gt;
&lt;h2&gt;Tip #86&lt;/h2&gt;
&lt;p&gt;When talking about ChipScope the signal attribute &lt;code&gt;keep&lt;/code&gt; should be mentioned,
since it often provides a way to find the post-synthesis nets. The &lt;code&gt;keep&lt;/code&gt;
attribute could also be combined with &lt;code&gt;debug&lt;/code&gt; attribute for easier identification
of signals.&lt;/p&gt;
&lt;p&gt;Verilog example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;(* keep = &amp;quot;true&amp;quot;, mark_debug = &amp;quot;true&amp;quot; *)&lt;/span&gt; &lt;span class="n"&gt;wire&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;signal_to_be_dbged&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Tip #90&lt;/h2&gt;
&lt;p&gt;UCF constants are completely out of date, and were replaced by an equivalent of
Synopsys Design Contraints in Vivado.&lt;/p&gt;
&lt;h2&gt;Tip #93&lt;/h2&gt;
&lt;p&gt;There is a parameter called &lt;code&gt;cost table&lt;/code&gt; between the options for placer, but the
description would suggest that this may be better called seed, since it provides
a starting point for randomized algorithm (placement).&lt;/p&gt;
&lt;h2&gt;Tip #97&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://jenkins.io/"&gt;Jenkins&lt;/a&gt; is a more-popular fork of Hudson CI. With a good
support for tcl, Vivado offers a reasonable easy way to automate the compilation
of the entire project directly from the source code in the repository.&lt;/p&gt;
&lt;p&gt;Another tools which could be added to this list is &lt;a href="http://www.ohwr.org/projects/hdl-make"&gt;hdlmake&lt;/a&gt;
which is meant to be an equivalent of Make for FPGA projects. Currently it is
not able to tackle more complex compilation procedures, such as re-compiling
vendor IP cores or handling Vivado Block Diagrams.&lt;/p&gt;</content><category term="FPGA"></category><category term="Xilinx"></category></entry><entry><title>Debugging Linux start-up on Altera Cyclone V SoC with OpenOCD</title><link href="www.j-marjanovic.io/debugging-linux-start-up-on-altera-cyclone-v-soc-with-openocd.html" rel="alternate"></link><published>2016-07-12T22:00:00+02:00</published><updated>2016-07-12T22:00:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2016-07-12:www.j-marjanovic.io/debugging-linux-start-up-on-altera-cyclone-v-soc-with-openocd.html</id><summary type="html">&lt;p&gt;This blog post will show you how one can use the OpenOCD debugger with Altera
Cyclone V SoC. Altera Cyclone V SoC is a very interesting integrated circuit,
combining dual-core ARM processor and a decent FPGA, allowing a wide variety
of possibilities to partition the application between the two.&lt;/p&gt;
&lt;p&gt;Xilinx …&lt;/p&gt;</summary><content type="html">&lt;p&gt;This blog post will show you how one can use the OpenOCD debugger with Altera
Cyclone V SoC. Altera Cyclone V SoC is a very interesting integrated circuit,
combining dual-core ARM processor and a decent FPGA, allowing a wide variety
of possibilities to partition the application between the two.&lt;/p&gt;
&lt;p&gt;Xilinx offers Xilinx SDK as the tool to program and debug their MicroBlaze
soft-core and ARM cores in their Zynq FPGAs. Altera on the other hand has two
different tools to program and debug their portfolio of processors. There is
Nios II EDS which provides support for Nios soft-core processor and there is 
ARM DS-5 Development Studio, which provides support for ARM cores in Altera SoCs. While I believe
DS-5 can be useful tool, unfortunately the free-as-a-beer &lt;a href="https://developer.arm.com/products/software-development-tools/ds-5-development-studio/editions/customized-editions/altera/community-edition"&gt;DS-5 Community Edition&lt;/a&gt;
only allows debugging Linux user-space applications. In order to use it, the 
Linux should be up and running in order to run gdbserver on processor.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Debug options in DS-5 Altera Community Edition" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/ds5_debug_options.png" style="max-width:100%; width: auto; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;When doing initial bring-up or experimenting this may not be the case. If
there is something wrong with a kernel, a device tree or the drivers, one can
easily find himself with a non-responsive system. Even in this case the JTAG
debugger offers a side-door access to the system. This greatly simplifies
determining the cause which lead to the system halt.&lt;/p&gt;
&lt;h1&gt;Installation of OpenOCD&lt;/h1&gt;
&lt;h2&gt;OpenOCD&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://openocd.org/"&gt;OpenOCD&lt;/a&gt; is a free and open-source on-chip debugger. It
provides a link between hardware components and a command line interface,
which can be used to control and monitor the hardware over JTAG interface. It
can also be interfaced with GDB (GNU Debugger) integrated with Eclipse, to
provide a graphical way to debug programs. If you want to know more, at the
bottom of &lt;a href="http://openocd.org/documentation/"&gt;OpenOCD Documentation page&lt;/a&gt; is
a link to the presentation on FOSDEM 2006.&lt;/p&gt;
&lt;p&gt;First we need to install all needed tools:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install libtool autotools-dev automake libusb-1.0 libhidapi-dev pkg-config git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we get the source code from OpenOCD SourceForge repository. I have used the
latest available commit in master, which was the one with a git tree-ish value
of &lt;code&gt;12ff09f&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone git://git.code.sf.net/p/openocd/code openocd-code

root@eee2f562f8f2:/openocd-code2# git show HEAD
commit 12ff09f7f27a707fe42226262f55b8ce8351cbf9
Author: Esben Haabendal &amp;lt;esben@haabendal.dk&amp;gt;
Date:   Fri Nov 27 09:13:36 2015 +0100
cfi: Add support for strangely endianness broken SoC implementations
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Perform all needed steps to compile the code (have a look in &lt;code&gt;INSTALL&lt;/code&gt; for
detailed instructions):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cd openocd-code
aclocal
./bootstrap
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;At the end of configure step make sure that support for Altera USB-Blaster II
and CMSIS-DAP Debugger are configured. The output should look something like
this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./configure

...

OpenOCD configuration summary
--------------------------------------------------
MPSSE mode of FTDI based devices        yes (auto)
Segger J-Link JTAG Programmer           yes (auto)
ST-Link JTAG Programmer                 yes (auto)
TI ICDI JTAG Programmer                 yes (auto)
Keil ULINK JTAG Programmer              yes (auto)
Altera USB-Blaster II Compatible        yes (auto)
Versaloon-Link JTAG Programmer          yes (auto)
OSBDM (JTAG only) Programmer            yes (auto)
eStick/opendous JTAG Programmer         yes (auto)
Andes JTAG Programmer                   yes (auto)
USBProg JTAG Programmer                 no
Raisonance RLink JTAG Programmer        no
Olimex ARM-JTAG-EW Programmer           no
CMSIS-DAP Compliant Debugger            yes (auto)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we just need to compile everything and install the openocd binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make

sudo make install
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;&lt;code&gt;udev&lt;/code&gt; rules for USB-Blaster&lt;/h2&gt;
&lt;p&gt;After the OpenOCD is installed, we must take care to set the correct &lt;code&gt;udev&lt;/code&gt;
rules (access permisions for USB device). As a workaround I have been chmod-ing
the &lt;code&gt;/dev/bus/usb/002/&lt;/code&gt; folder to &lt;code&gt;0666&lt;/code&gt; and that gave me correct permission
to use the USB-Blaster from Altera Quartus software.&lt;/p&gt;
&lt;p&gt;The more elegant solution is described in the comment section of &lt;a href="http://www.fpga-dev.com/altera-usb-blaster-with-
ubuntu/"&gt;ALTERA USB-BLASTER
WITH UBUNTU 14.04&lt;/a&gt;. The USB-Blaster has multiple personalities (one for FPGA JTAG and
one for ARM JTAG), the udev rule therefore needs to specify both 6010 and
6810 as the targeted devices.&lt;/p&gt;
&lt;p&gt;Create /etc/udev/rules.d/51-usbblaster.rules with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# For Altera USB-Blaster on SoCkit
SUBSYSTEM==&amp;quot;usb&amp;quot;,\
ENV{DEVTYPE}==&amp;quot;usb_device&amp;quot;,\
ATTR{idVendor}==&amp;quot;09fb&amp;quot;,\
ATTR{idProduct}==&amp;quot;6010|6810&amp;quot;,\
MODE=&amp;quot;0666&amp;quot;,\
NAME=&amp;quot;bus/usb/$env{BUSNUM}/$env{DEVNUM}&amp;quot;,\
RUN+=&amp;quot;/bin/chmod 0666 %c&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;udev&lt;/code&gt; rules should be reloaded with the following command to take effect
immediately:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo udevadm control --reload
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;First checks&lt;/h2&gt;
&lt;p&gt;Now we can try running Altera &lt;code&gt;jtagconfig&lt;/code&gt; program to check if the permissions
are OK. When the SoCkit board is attached, the output should look something
like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  ~ ~/altera/16.0/quartus/bin/jtagconfig                                                                                            
1) CV SoCKit [1-1.1]                          
  02D020DD   5CSEBA6(.|ES)/5CSEMA6/..
  4BA00477   SOCVHPS
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now we can also try running OpenOCD:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  ~ openocd -f interface/altera-usb-blaster2.cfg -f target/altera_fpgasoc.cfg
Open On-Chip Debugger 0.10.0-dev-00324-g12ff09f (2016-06-26-19:19)
Licensed under GNU GPL v2
For bug reports, read
http://openocd.org/doc/doxygen/bugs.html
Warn : Adapter driver &amp;#39;usb_blaster&amp;#39; did not declare which transports it allows; assuming legacy JTAG-only
Info : only one transport option; autoselect &amp;#39;jtag&amp;#39;
adapter speed: 1000 kHz
cycv_dbginit
Info : Altera USB-Blaster II (uninitialized) found
Info : Loading firmware...
Info : Waiting for renumerate...
Info : Waiting for renumerate...
Info : Altera USB-Blaster II found (Firm. rev. = 1.36)
Info : This adapter doesn&amp;#39;t support configurable speed
Info : JTAG tap: fpgasoc.dap tap/device found: 0x4ba00477 (mfg: 0x23b (ARM Ltd.), part: 0xba00, ver: 0x4)
Info : JTAG tap: fpgasoc.fpga.tap tap/device found: 0x02d020dd (mfg: 0x06e (Altera), part: 0x2d02, ver: 0x0)
Info : DAP transaction stalled (WAIT) - slowing down
Info : DAP transaction stalled (WAIT) - slowing down
Info : DAP transaction stalled (WAIT) - slowing down
Info : fpgasoc.cpu.0: hardware has 6 breakpoints, 4 watchpoints
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This gives us information that ARM core was recognized, this is therefore the
correct command to use it later with the GDB debugger.&lt;/p&gt;
&lt;h2&gt;Eclipse plug-in&lt;/h2&gt;
&lt;p&gt;Now we just have to set-up the Eclipse with the OpenOCD plug-in. I have used the
newest version of Eclipse available at the moment, Eclipse Neon.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Eclipse Neon" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_neon.png" style="width:500px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://gnuarmeclipse.github.io/plugins/install/"&gt;This page&lt;/a&gt; describes how to
install the OpenOCD plug-in for Eclipse, the easiest way is to drag and drop
install icon into a running instance of Eclipse.&lt;/p&gt;
&lt;p&gt;Once this is set, we can create a new project. For simpler (bare-metal)
project it would probably make sense to go with "Makefile Project with
Existing Code". For a Linux kernel debugging the plain Project will be enough.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_new_project.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_new_project_name.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;Now let's find the original Linux binary. When building kernel with Yocto, the
created file in deploy directory is &lt;code&gt;zimage&lt;/code&gt; file. This is a compressed image
with all debugging symbols stripped out. It is optimized to be used in
embedded environment. We need to find the original &lt;code&gt;vmlinux&lt;/code&gt; image before the
debugging symbols were stripped out:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  tmp git:(jethro) find . -name vmlinux                                       
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.3+gitAUTOINC+5938523338-r0/
linux-cyclone5-standard-build/arch/arm/boot/vmlinux
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.3+gitAUTOINC+5938523338-r0/
linux-cyclone5-standard-build/arch/arm/boot/compressed/vmlinux
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.3+gitAUTOINC+5938523338-r0/
linux-cyclone5-standard-build/vmlinux
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.4+gitAUTOINC+969478b841-r0/
linux-cyclone5-standard-build/arch/arm/boot/vmlinux
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.4+gitAUTOINC+969478b841-r0/
linux-cyclone5-standard-build/arch/arm/boot/compressed/vmlinux
./work/cyclone5-poky-linux-gnueabi/linux-altera/4.4+gitAUTOINC+969478b841-r0/
linux-cyclone5-standard-build/vmlinux
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There are various images from various different runs (and different versions
of the kernel).&lt;/p&gt;
&lt;p&gt;In Eclipse we then select: &lt;code&gt;Run -&amp;gt; Debug Configurations...&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And then we just need to setup the correct parameters for debug. Under "Main
tab" we need to select the right Linux binary image:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_debug_main.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;Under "Debugger tab" we need to set-up the OpenOCD setting and use the correct
gdb (the one produced by Yocto):&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_debug_debugger.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;If we want to attach to a running kernel, we should un-check "Inital Reset"
and "Load executable" fields under "Startup tab".&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_debug_startup.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;
&lt;p&gt;And we are good to go. After pressing the "Debug" button, the debugging
perspective will show up. Now we can access &lt;code&gt;__log_buf&lt;/code&gt; buffer to determine
what is stopping the kernel boot.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creation of new project in Eclipse" src="www.j-marjanovic.io/images/debugging_cyclone_soc_openocd/eclipse_debug_final.png" style="width:800px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;/p&gt;</content><category term="FPGA"></category><category term="Altera"></category><category term="Linux"></category><category term="OpenOCD"></category></entry><entry><title>Books read: 97 Things Every Programmer Should Know</title><link href="www.j-marjanovic.io/books-read-97-things-every-programmer-should-know.html" rel="alternate"></link><published>2016-06-05T22:00:00+02:00</published><updated>2016-06-05T22:00:00+02:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2016-06-05:www.j-marjanovic.io/books-read-97-things-every-programmer-should-know.html</id><summary type="html">&lt;p&gt;I have seen this book referenced on several occasions when the software
engineering was discussed, but I never had the time to read from first page to
the last. I bought the dead-tree version, which gives you a better motivation
to read the whole book. Here are my comments and …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I have seen this book referenced on several occasions when the software
engineering was discussed, but I never had the time to read from first page to
the last. I bought the dead-tree version, which gives you a better motivation
to read the whole book. Here are my comments and thoughts about each
contribution in this book.&lt;/p&gt;
&lt;p style="width:70%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="97 Things Every Programmer Should Know" src="www.j-marjanovic.io/images/97_thing_every_programmer_should_know.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;(1) Act with Prudence by Seb Rose&lt;/h2&gt;
&lt;p&gt;Technical debt is (similarly to a cash debt) a good way to kickstart the
development, but I agree with the author that is should be kept under control
and paid back as soon as possible. I much enjoy when a sub-optimal solution
gets fixed and the worries about possible problems with it vanish away.&lt;/p&gt;
&lt;h2&gt;(2) Apply Functional Programming Principles by Edward Garson&lt;/h2&gt;
&lt;p&gt;Yes, I am already excited about this book. The functional programming
principles (even in OO code) greatly improve testability of smaller components.
It also gives a programmer a different insight on how algorithms work, which
its a little more detached from how a classical computer works. Programming in
C feels like explaining complicated science to a 7 year old ("lets have a
number i, which is is set to 0. each time we will check if this number is less
than some other number n..."), while programming in Haskell feels like a
discussion with a philosopher ("there is this function fact for which the
value for 1 is 1. - oh, i see. - and for every other positive number, the
value is the argument itself multiplied by the value of function for an
argument minus one. - well, this is everything i needed to know about this
function, i think i know how to calculate it."&lt;/p&gt;
&lt;h2&gt;(3) Ask, "What Would the User Do?" (You Are Not the User) by Giles Colborne&lt;/h2&gt;
&lt;p&gt;This contribution is quite similar to Joel Spolsky
&lt;a href="http://www.joelonsoftware.com/uibook/chapters/fog0000000064.html"&gt;comment&lt;/a&gt; on
how to test the use interface: "One good way to evaluate the usability of a
program or dialog you've never seen before is to act a little stupid".  The
important reminder to take away from this is to try being conservative with
the user interface, to minimize the learning how to use your program or
application.&lt;/p&gt;
&lt;h2&gt;(4) Automate Your Coding Standard by Filip van Laenen&lt;/h2&gt;
&lt;p&gt;Nicely formatted code demonstrates that the person who wrote it has put in a
little effort to make it nicer and that the same person is somebody who like
to keep things organized. On the contrary, when you see a messy code with
sections of the code commented out, you know that there is almost surely
something wrong with its behavior as well. Clearly defined language-prescribed
formating standard (such as PEP8) and the tools to support it (such as pep8
tool and pylint) are much welcomed. Meanwhile, the &lt;a href="htt
ps://github.com/isocpp/CppCoreGuidelines/blob/5eb0b587af06dc5d1d9cda0dd8c6b399
bdc1e230/CppCoreGuidelines.md"&gt;C++ coding guidelines&lt;/a&gt; currently looks more like a brainstorming
session (why is there std::endl if you are not supposed to use it?)&lt;/p&gt;
&lt;h2&gt;(5) Beauty Is in Simplicity by Jørn Ølmheim&lt;/h2&gt;
&lt;p&gt;Simple solution are often the ones who work better, not only in software but
also in other fields, such as rock music. Trying to write the most legendary
rock riff of all time? You only need 4 notes (Yngwie does not agree with this:
&lt;a href="https://www.youtube.com/watch?v=QHZ48AE3TOI"&gt;More is more&lt;/a&gt; ). As an example
lets look at one  of the biggest code bases ever made: Linux kernel. The style
itself (tabs are 8 spaces, line is 80 characters) prevent you from writing too
complicated solution. The style guide for Linux kernel is a little extreme,
but since the kernel should be as lean as possible it produces indisputably
good results.&lt;/p&gt;
&lt;h2&gt;(6) Before You Refactor by Rajith Attapattu&lt;/h2&gt;
&lt;p&gt;This contribution is again very similar to one of Joel Spolsky's &lt;a href="http://www.joelonsoftware.com/articles/fog0000000069.html"&gt;blog
posts&lt;/a&gt;. Since
reading code is harder than writing it everybody assumes that a complete
rewrite will create better code. All the ugly patches in the code are actual
bugfixes and the software (although with ugly code) works.&lt;/p&gt;
&lt;h2&gt;(7) Beware the Share by Udi Dahan&lt;/h2&gt;
&lt;p&gt;Using already written libraries is a nice practice, and this contribution
talks about creating unwanted dependencies in the code base. The discussion
here regards the internally developed libraries. The case described in this
contribution can be also analyzed in terms of the time spent maintaining
reusable code, something which is described in The Mythical Man-Month. Use of
public (external) stable libraries should be encouraged, although I would in
the controversial case of leftPad function prefer to have the leftPad function
embedded directly in code.&lt;/p&gt;
&lt;h2&gt;(8) The Boy Scout Rule by Robert C. Martin&lt;/h2&gt;
&lt;p&gt;This is one of the most famous contribution in this book, I don't think there
is much to add to it. It is always nice when you look back at the clean
campground (I sometimes like to admire the cleanup in side-by-side diff).&lt;/p&gt;
&lt;h2&gt;(9) Check Your Code First Before Looking to Blame Others by Allan Kelly&lt;/h2&gt;
&lt;p&gt;I would also like to add that a really good understanding of the language
(read the standard) and the compiler (read  the manual) can help you resolve
the problem without blaming the compiler. Personally I know about some miner
differences between Verilog compilers from Xilinx and Altera, which could let
someone think that the compiler is buggy.&lt;/p&gt;
&lt;h2&gt;(10) Choose Your Tools with Care by Giovanni Asproni&lt;/h2&gt;
&lt;p&gt;The author of this contribution mentions that he likes to isolate external
tools from his own business logic. I see this approach sometimes in open
source FPGA development when a wrapper around some commonly used IP cores is
build (e.g. wrapper around block RAM for both Altera and Xilinx which gets
chosen based on a parameter or a macro).&lt;/p&gt;
&lt;h2&gt;(11) Code in the Language of the Domain by Dan North&lt;/h2&gt;
&lt;p&gt;This contribution could be summarized as a call to use sensible
variable/functions/object/methods names. This could be as well extended to
writing informative comments, and not have comments like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if (maxLim &amp;lt; 0) // checks if max limit is negative
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;(12) Code Is Design by Ryan Brush&lt;/h2&gt;
&lt;p&gt;The abstract process of making virtual artifacts (software) from nothing
cannot be compared with construction process. The possibility to experiment
with the real product gives direct feedback, which can be easily incorporated
into design process. I often see everyday physical objects which weren't
optimized to perfection, probably because of high iteration cost. The location
of power button on my HTC Desire is one of this design flaws, it cannot be
reached without changing the grip on the phone.&lt;/p&gt;
&lt;h2&gt;(13) Code Layout Matters by Steve Freeman&lt;/h2&gt;
&lt;p&gt;Indentation of the code is important, it provides the overview of the
complexity on the first glance. I look forward to GCC6 new warning on wrongly
indented C/C++ code.&lt;/p&gt;
&lt;h2&gt;(14) Code Reviews by Mattias Karlsson&lt;/h2&gt;
&lt;p&gt;Code reviews are important because they introduce all-seeing-eye in the code
writing process, and this makes programmers care more about code quality. One
cannot just make a ugly patch and hide in somewhere in the code base. The
ultimate code review is the release of the code to the public or to the
clients. In this case one can be sure that the company will be judged by the
quality of the released code. The same is true for the examples which
demonstrates the use of someone own tools.&lt;/p&gt;
&lt;p&gt;To be continued in the next blog post...&lt;/p&gt;</content><category term="Software Engineering"></category></entry><entry><title>HDL data type for Python parser implementations</title><link href="www.j-marjanovic.io/hdl-data-type-for-python-parser-implementations.html" rel="alternate"></link><published>2015-11-15T22:00:00+01:00</published><updated>2015-11-15T22:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2015-11-15:www.j-marjanovic.io/hdl-data-type-for-python-parser-implementations.html</id><summary type="html">&lt;p&gt;Recently I had to implement a parser for the PCIe protocol. The data was
captured with Xilinx ChipScope and saved as TSV (tab-separated value) text file.
I wanted to implement a parser in Python, my favorite language for this kind of
tasks. I have stumbled to a problem when I …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently I had to implement a parser for the PCIe protocol. The data was
captured with Xilinx ChipScope and saved as TSV (tab-separated value) text file.
I wanted to implement a parser in Python, my favorite language for this kind of
tasks. I have stumbled to a problem when I needed an elegant way to represent
the vector of bits of arbitrary length. I have found several libraries but none
of them satisfied my needs, so I put together a small class, which mimics
SystemVerilog vectors.&lt;/p&gt;
&lt;script src="https://gist.github.com/j-marjanovic/348499e6cae3622554a4.js"&gt;&lt;/script&gt;

&lt;p&gt;Let's have a look at other alternatives which were available but did not
completely suit my needs. I wanted a vector slicing syntax which is similar to
the one in SystemVerilog and it allows to catch the typos quickly.&lt;/p&gt;
&lt;h2&gt;bitstring&lt;/h2&gt;
&lt;p&gt;From their site: &lt;a href="https://pypi.python.org/pypi/bitstring/3.1.3"&gt;bitstring&lt;/a&gt; is a
pure Python module designed to help make the creation and analysis of binary
data as simple and natural as possible.&lt;/p&gt;
&lt;p&gt;It quick test finds two things which I would did not like: taking slice wider
than vector length pads the resulting vector with zeros and the slice indexes
are inverted compared to more used [higher_limit:lower_limit] notation in HDLs.
The output of the slicing is a closed interval, which is the behavior I would
expect.&lt;/p&gt;
&lt;h2&gt;BitArray&lt;/h2&gt;
&lt;p&gt;The first thing which comes in mind is that there is not an easy way to create a
bitarray and initialize it from int in a single step (using constructor). The
only way to initialize BitArray is to use binary-formated string. This requires
a call of bin() function and dropping first two characters if your data is
stored as an int. At this point one can already start thinking of implementing
it's own class. The slicing has the same behavior as bitstring, which I did not
like for the application I need.&lt;/p&gt;
&lt;h2&gt;A simple solution on Stack Overflow&lt;/h2&gt;
&lt;p&gt;There is a &lt;a href="http://stackoverflow.com/a/150411/4059686"&gt;similar solution&lt;/a&gt; already
posted on Stack Overflow, however it lacks an equality operator.&lt;/p&gt;
&lt;h2&gt;MyHDL&lt;/h2&gt;
&lt;p&gt;Since MyHDL is a way to write HDL with Python it comes as obvious choice to use
it in a simple Python parser. MyHDL has a &lt;em&gt;intbv&lt;/em&gt; data type which is very
similar to vectors in Verilog and VHDL. However, there are some minor things
which discouraged me from using it in my parser.&lt;/p&gt;
&lt;p&gt;Lets have a look at a modified version of the VerilogBits unit test:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;unittest&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;myhdl&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Testmyhdlintbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;unittest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TestCase&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_equality&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x0AB&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertNotEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xCD&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_slicing&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;ab&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xA&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xB&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_unpack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;abcd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xABCD&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;abcd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;abcd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;abcd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;abcd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xA&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xB&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xC&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xD&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_slice_up_vect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertRaises&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;dummy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_invalid_slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertRaises&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;IndexError&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;dummy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myhdl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intbv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xAB&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;unittest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This results are 3 failing tests: test_invalid_slice, test_slicing, and
test_unpack. test_invalid_slice fails because taking a slice wider than a vector
width produces fills the missing bits with zero. This is similar to
SystemVerilog vector of bits, which is a 2-level data type (it can be only 0 or
1). I prefer more rigorous behavior when slicing vectors, since errors like that
can be quite hard to catch. The VerilogBits throws an exception when an invalid
slice is requested.&lt;/p&gt;
&lt;p&gt;If the zero padding problem with MyHDL is something I could live with, the other
two failing test are much more discouraging for someone who sometimes dreams
(System)Verilog. The &lt;a href="http://docs.myhdl.org/en/stable/manual/hwtypes.html#bit-slicing"&gt;bit slicing in
MyHDL&lt;/a&gt; is half-
open as is expected in Python and not a closed interval as expected from HDLs
(e.g.  to get the LSB one should write [8:0] instead of [7:0]). Again, this is
just a convention and the software world is using the half-open interval for
decades (&lt;a href="https://www.cs.utexas.edu/users/EWD/ewd08xx/EWD831.PDF"&gt;E.W.Dijkstra: Why numbering should start at
zero&lt;/a&gt;). But if your
parser in Python is there to find bugs in your SystemVerilog code, it makes much
more sense to use the same notation in both languages.&lt;/p&gt;
&lt;h2&gt;SystemVerilog&lt;/h2&gt;
&lt;p&gt;The SystemVerilog provide all the necessary tools to effectively manipulate bits
(duh), but the Python with the generators, list comprehensions and dictionaries
(well, SystemVerilog does have associative array) is much more elegant language.
The ability to test commands on-the-fly in the interpreter is also much
welcomed.&lt;/p&gt;</content><category term="Python"></category><category term="Verilog"></category><category term="FPGA"></category><category term="HDL"></category></entry><entry><title>Compilation of Linux kernel for Raspberry Pi</title><link href="www.j-marjanovic.io/compilation-of-linux-kernel-for-raspberry-pi.html" rel="alternate"></link><published>2015-03-01T19:00:00+01:00</published><updated>2015-03-01T19:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2015-03-01:www.j-marjanovic.io/compilation-of-linux-kernel-for-raspberry-pi.html</id><summary type="html">&lt;p&gt;Yesterday I got my Raspberry Pi 2, the evolution of the legendary Raspberry Pi. 
The evolution is the right word to describe what has changed compared to 
the previous version. The processor it is now a quad-core, it runs faster,
it has got a newer instruction set (ARMv7) and the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Yesterday I got my Raspberry Pi 2, the evolution of the legendary Raspberry Pi. 
The evolution is the right word to describe what has changed compared to 
the previous version. The processor it is now a quad-core, it runs faster,
it has got a newer instruction set (ARMv7) and the board now incorporates 1GB
of RAM and 4 USB connector. The RCA jack is no longer present, the additional
place is being occupied by a larger extension header instead. A welcomed update
of already great hardware, in my opinion (for people complaining that it
can't play 4K video, run desktop version of the Windows, ..., well, consider
buying proper computer, RPi was meant to be cheep enough to tinker with
without fear of breaking something).&lt;/p&gt;
&lt;p&gt;I am the kind of the person which thinks that compiling Linux kernel would be 
great a way to spend the Sunday. Since one of my projects with RPi includes
custom driver for communication with FPGA, I needed Linux headers and &lt;em&gt;kbuild&lt;/em&gt;
system for building kernel modules (those who are not familiar with the procedure,
imagine that you are building a program linked with libraries; in this case a 
program is a kernel module and kernel and its modules represent the libraries).&lt;/p&gt;
&lt;p&gt;On the Ubuntu (and I think on other Debian systems but I am not 100% sure) you
can get kernel headers and source directly from the Debian repository, something
like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install linux-headers-&lt;span class="k"&gt;$(&lt;/span&gt;uname -r&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The above command will install the headers the headers for the currently running 
kernel. It copies the header files to /usr/src and creates link in /lib/modules/,
this gives the user tools needed to compile kernel modules.&lt;/p&gt;
&lt;h2&gt;The hard way&lt;/h2&gt;
&lt;p&gt;Before you continue reading I would just like to inform you that the procedure 
described in this section did not yield desired result. Although I managed to 
get a kernel image, the &lt;em&gt;kbuild&lt;/em&gt; system did not work. In Thomas Alva Edison style
 I want to present a method which does not work, but at least we know it does not work. The working (and easier) procedure is described in the next section.&lt;/p&gt;
&lt;p&gt;Initially I wanted to get the headers in the same way as I would on Ubuntu, by
using apt (Advanced Packaging Tool). Searching for available packages did not
show the package needed (the Raspbian was running the 3.18.7-v7+ kernel).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;pi@raspberrypi ~ $&lt;/span&gt; sudo aptitude search linux-headers
&lt;span class="go"&gt;v   linux-headers                                   -                                                           &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.10-3-all                        - All header files for Linux 3.10 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.10-3-all-armhf                  - All header files for Linux 3.10 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.10-3-common                     - Common header files for Linux 3.10-3                      &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.10-3-rpi                        - Header files for Linux 3.10-3-rpi                         &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.12-1-all                        - All header files for Linux 3.12 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.12-1-all-armhf                  - All header files for Linux 3.12 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.12-1-common                     - Common header files for Linux 3.12-1                      &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.12-1-rpi                        - Header files for Linux 3.12-1-rpi                         &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.18.0-trunk-all                  - All header files for Linux 3.18 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.18.0-trunk-all-armhf            - All header files for Linux 3.18 (meta-package)            &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.18.0-trunk-common               - Common header files for Linux 3.18.0-trunk                &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.18.0-trunk-rpi                  - Header files for Linux 3.18.0-trunk-rpi                   &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.18.0-trunk-rpi2                 - Header files for Linux 3.18.0-trunk-rpi2                  &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.2.0-4-all                       - All header files for Linux 3.2 (meta-package)             &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.2.0-4-all-armhf                 - All header files for Linux 3.2 (meta-package)             &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.2.0-4-common                    - Common header files for Linux 3.2.0-4                     &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.2.0-4-rpi                       - Header files for Linux 3.2.0-4-rpi                        &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.6-trunk-all                     - All header files for Linux 3.6 (meta-package)             &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.6-trunk-all-armhf               - All header files for Linux 3.6 (meta-package)             &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.6-trunk-common                  - Common header files for Linux 3.6-trunk                   &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-3.6-trunk-rpi                     - Header files for Linux 3.6-trunk-rpi                      &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-rpi                               - Header files for Linux rpi configuration (meta-package)   &lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-rpi-rpfv                          - This metapackage will pull in the headers for the raspbian&lt;/span&gt;
&lt;span class="go"&gt;p   linux-headers-rpi2-rpfv                         - This metapackage will pull in the headers for the raspbian&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I tried my luck with &lt;em&gt;linux-headers-rpi2-rpfv&lt;/em&gt; which installed headers for
kernel 3.18.0. That might sound close enough, but Linux refuses modules which
have not been compiled with exactly the same same kernel. &lt;/p&gt;
&lt;p&gt;So I decided to recompile the kernel on my laptop running Ubuntu. The procedure
of compiling on one type of machine (in this case Intel x86_64 processor) for
another (in this case ARM processor) is called cross-compilation.&lt;/p&gt;
&lt;p&gt;The process of cross-compilation is described here: &lt;a href="http://elinux.org/Raspberry_Pi_Kernel_Compilation"&gt;Raspberry Pi Kernel Compilation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Everything went fine, I got the kernel image and /lib/modules directory. The only
thing that the guide does not mention is that &lt;em&gt;make modules_install&lt;/em&gt; creates 
symbolic links to the original directory. I copied the entire kernel directory
to /usr/src and recreated symbolic links, so everything should be fine.&lt;/p&gt;
&lt;p&gt;At this point if everything went OK we would have a working kernel and its 
&lt;em&gt;kbuild&lt;/em&gt; system which gives us the tools to compile the kernel modules out of the
tree (in a separate directory). The RPi boots up, which is a good sign, meaning
that there is nothing wrong with the kernel image. &lt;/p&gt;
&lt;p&gt;However, when I try to compile the kernel module, I get the error saying that 
there is a syntax error in script in kernel module 
(the same problem as described &lt;a href="http://stackoverflow.com/questions/17282461/scripts-recordmcount-syntax-error-when-i-try-to-build-a-linux-kernel-module-o"&gt;here&lt;/a&gt;. The answer by Joe C states:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Anyway, if you cross compile you don't get a /usr/src/linux-header-x.x.x/scripts dir that's usable on your target system.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Since I previously downloaded another kernel headers from Debian repository,
I tired copying the scripts directory from there:&lt;/p&gt;
&lt;p&gt;pi@raspberrypi /usr/src/linux-headers-3.18.0-trunk-rpi2 $ sudo cp -rv scripts/ ../linux-sources-3.18.8-v7+/&lt;/p&gt;
&lt;p&gt;This fixed the compilation problem just to cause complete disaster when I
tried inserting the module. The following kernel message (&lt;em&gt;dmesg&lt;/em&gt; command)
shows nothing promising:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[ 4246.164155] Unable to handle kernel paging request at virtual address fe220b30
[ 4246.176292] pgd = b5dd8000
[ 4246.183812] [fe220b30] *pgd=00000000
[ 4246.192196] Internal error: Oops: 5 [#1] PREEMPT SMP ARM
[ 4246.202324] Modules linked in: pi64_dev(O+) snd_bcm2835 snd_soc_pcm512x_i2c snd_soc_wm8804 snd_soc_pcm512x snd_soc_tas5713 regmap_spi regmap_i2c snd_soc_bcm2708_i2s regmap_mmio snd_soc_core snd_compress snd_pcm_dmaengine snd_pcm snd_seq snd_seq_device snd_timer r8712u(C) snd spi_bcm2708 i2c_bcm2708
[ 4246.239611] CPU: 3 PID: 3468 Comm: insmod Tainted: G         C O   3.18.8-v7+ #1
[ 4246.252306] task: b87aa840 ti: b760a000 task.ti: b760a000
[ 4246.262985] PC is at load_module+0x1a64/0x1f0c
[ 4246.272699] LR is at load_module+0x1a50/0x1f0c
[ 4246.282373] pc : [&amp;lt;800940d4&amp;gt;]    lr : [&amp;lt;800940c0&amp;gt;]    psr: 90000013
[ 4246.282373] sp : b760be88  ip : 7f110770  fp : b760bf44
[ 4246.304401] r10: 00000000  r9 : 7f110600  r8 : 80536d44
[ 4246.314883] r7 : b86dc8c4  r6 : fe220b1c  r5 : 7f11060c  r4 : b760bf48
[ 4246.326685] r3 : 00000000  r2 : b760be70  r1 : b7555280  r0 : 807f2a3c
[ 4246.338495] Flags: NzcV  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user
[ 4246.350916] Control: 10c5387d  Table: 35dd806a  DAC: 00000015
[ 4246.361932] Process insmod (pid: 3468, stack limit = 0xb760a238)
[ 4246.373206] Stack: (0xb760be88 to 0xb760c000)
[ 4246.382808] be80:                   7f11060c 00007fff 8009168c ffffffff b760bee4 bd949000
[ 4246.396352] bea0: 00000000 7f11060c 00000000 b760bedc 807e4d78 7f110648 b760a000 7f110770
[ 4246.409938] bec0: 00001f4b 806c9bdc ba7b961c b760a000 b9330000 808ab8fc 76fd3000 00000000
[ 4246.423538] bee0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[ 4246.437137] bf00: 00000000 00000000 00000000 00000000 00000000 00000000 00000080 00001f4b
[ 4246.450707] bf20: 76fd3000 76f91948 00000080 8000f0a4 b760a000 00000000 b760bfa4 b760bf48
[ 4246.464292] bf40: 80094664 8009267c bd949000 00001f4b bd949f3c bd949de3 bd94acc4 00000850
[ 4246.477932] bf60: 00000940 00000000 00000000 00000000 0000001f 00000020 00000017 00000014
[ 4246.491605] bf80: 00000010 00000000 00000000 7eb7861c 00000000 7768b038 00000000 b760bfa8
[ 4246.505297] bfa0: 8000ee20 80094588 7eb7861c 00000000 76fd3000 00001f4b 76f91948 76fd3000
[ 4246.519052] bfc0: 7eb7861c 00000000 7768b038 00000080 7768af80 00001f4b 76f91948 00000000
[ 4246.532810] bfe0: 00000000 7eb785c4 76f88fb4 76ef3ab4 60000010 76fd3000 d466662e d5f7abd0
[ 4246.546635] [&amp;lt;800940d4&amp;gt;] (load_module) from [&amp;lt;80094664&amp;gt;] (SyS_init_module+0xe8/0xfc)
[ 4246.560087] [&amp;lt;80094664&amp;gt;] (SyS_init_module) from [&amp;lt;8000ee20&amp;gt;] (ret_fast_syscall+0x0/0x48)
[ 4246.573935] Code: e51bc088 e15c0006 e2466008 0a000009 (e5963014) 
[ 4246.604593] ---[ end trace 8e4bd0982f9f1fd0 ]---
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It basically says that there was an error trying to access the wrong part of the
memory from the &lt;em&gt;insmod&lt;/em&gt; process.&lt;/p&gt;
&lt;p&gt;At this point I decided to stop experimenting with this approach. I was getting
frustrated with constant fighting with all kind of errors. When I initially started
writing this blog post I wanted to describe the method to cross-compile Linux
kernel image and &lt;em&gt;kbuild&lt;/em&gt; build system. Unfortunately, although it may sound
appealing to speed up the process by cross compiling on x86 machine, the 
complication with various stuff make it more time consuming that compiling directly
on Raspberry Pi. I know myself good enough that I know I wont quit this easy.
I will probably return to this problem on some other occasion and tried again,
be assured that I will write a blog post If I succeed.&lt;/p&gt;
&lt;h2&gt;The easy way&lt;/h2&gt;
&lt;p&gt;At the end I dropped the cross-compilation idea and resorted to compiling kernel
on the RPi itself. This can also serve as a performance test of the new RPi. 
I overclocked it to 1000MHz (using raspi-config I selected the RPi2 setting).&lt;/p&gt;
&lt;p&gt;The compilation of kernel took something less than 2 hours, quite decent result
compared to 17 minutes it takes on my laptop with not-so-new i3 and 6GB of RAM.&lt;/p&gt;
&lt;p&gt;The following figure shows the temperature during the compilation. The temperature
was captured every minute with a Cron job which read from 
&lt;strong&gt;/sys/class/thermal/thermal_zone0/temp&lt;/strong&gt;&lt;/p&gt;
&lt;p style="width:90%; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="RPi temperature" src="www.j-marjanovic.io/images/pi_temp_during_compile.png"&gt;&lt;/p&gt;
&lt;p&gt;Finally, using freshly compiled kernel on RPi, I managed to get compile my 
module and to load it in kernel (debug message from kernel):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;[   38.324756] ============================================&lt;/span&gt;
&lt;span class="go"&gt;[   38.324786]        Pi64 driver by Jan Marjanovic        &lt;/span&gt;
&lt;span class="go"&gt;[   38.324796] &lt;/span&gt;
&lt;span class="go"&gt;[   38.324808]   built: Mar  1 2015 11:38:10&lt;/span&gt;
&lt;span class="go"&gt;[   38.324818] ============================================&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Raspberry Pi"></category></entry><entry><title>Lattice iCEcube2 on Ubuntu 14.04</title><link href="www.j-marjanovic.io/lattice-icecube2-on-ubuntu-1404.html" rel="alternate"></link><published>2015-03-01T19:00:00+01:00</published><updated>2015-03-01T19:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2015-03-01:www.j-marjanovic.io/lattice-icecube2-on-ubuntu-1404.html</id><summary type="html">&lt;p&gt;/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/synplify_pro: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/synplify_pro: 200: [: !=: argument expected
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/c_hdl: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/c_hdl: 200 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/synplify_pro: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/synplify_pro: 200: [: !=: argument expected
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/c_hdl: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/c_hdl: 200: [: !=: argument expected
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/syn_nfilter: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/syn_nfilter: 200: [: !=: argument expected
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/m_generic: 186: [: unexpected operator
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/m_generic: 200: [: !=: argument expected
/home/jan/opt/lscc/iCEcube2.2014.12/synpbase/bin/m_generic: 186: [: unexpected operator&lt;/p&gt;
&lt;p&gt;sed -i 's/\/bin\/sh/\/bin\/bash/g' *&lt;/p&gt;
&lt;p&gt;jan@jan-ThinkPad-T510 ~/opt/lscc/iCEcube2.2014.12/synpbase/bin
 % for file in $(ls); do sed -i 's/\/bin\/sh/\/bin\/bash/g' $file; done    19:33:27 on 2015-03-07 
sed: couldn't edit config: not a regular file
jan@jan-ThinkPad-T510 ~/opt/lscc/iCEcube2.2014.12/synpbase/bin
 % &lt;/p&gt;
&lt;p&gt;for file in $(ls -la | grep -E '^[^d]' | awk -F "/" '{print $NF}' ); do echo $file; done &lt;/p&gt;
&lt;p&gt;for file in $(ls -la | tail -n +2 | grep -E '^[^d]' | awk '{print $NF}' ); do sed -i 's/\/bin\/sh/\/bin\/bash/g' $file; done &lt;/p&gt;</content><category term="Lattice"></category><category term="iCE40"></category><category term="Linux"></category><category term="Ubuntu"></category></entry><entry><title>Lattice iCE40 configuration using Raspberry Pi</title><link href="www.j-marjanovic.io/lattice-ice40-configuration-using-raspberry-pi.html" rel="alternate"></link><published>2015-01-18T22:00:00+01:00</published><updated>2015-01-18T22:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2015-01-18:www.j-marjanovic.io/lattice-ice40-configuration-using-raspberry-pi.html</id><summary type="html">&lt;p&gt;As I mentioned in previous post, I started playing around with Lattice iCE40 FPGA. 
In the last post I did a quick overview of the 
iCE40 tools. The iCEcube2 cannot compete with Xilinx ISE and Altera Quartus II, 
not to mention the Vivado, but since this is a low-cost FPGA …&lt;/p&gt;</summary><content type="html">&lt;p&gt;As I mentioned in previous post, I started playing around with Lattice iCE40 FPGA. 
In the last post I did a quick overview of the 
iCE40 tools. The iCEcube2 cannot compete with Xilinx ISE and Altera Quartus II, 
not to mention the Vivado, but since this is a low-cost FPGA the current tool 
offers all you need to do this kind of simple projects (I would definitely recommend
the beginners to stay away from Lattice as it is not as user friendly as vendor X
or vendor A, you need to have some experience to master the work flow). &lt;/p&gt;
&lt;p&gt;Last time I found out that iCEcube2 Programmer runs only on Windows, on GNU/Linux 
you need to find other solutions. How the Programmer works is another interesting
thing. One would expect that is uses JTAG port on FPGA to configure it, but that is
not the case. The Programmer communicates with Atmel microcontroller which programs
Serial NOR Flash memory. Then it reset the FPGA which boots in SPI Master mode, and 
it reads configuration from Flash. &lt;/p&gt;
&lt;p&gt;A quick look at &lt;a href="http://www.latticesemi.com/~/media/Documents/ApplicationNotes/IK/iCE40ProgrammingandConfiguration.pdf?document_id=46502"&gt;TN1248: iCE40 Programming and Configuration&lt;/a&gt; 
shows that it can be programmed also by writing from 
another device (e.g. microprocessor to the SPI port). This is called SPI Slave 
programming mode and it is enabled by holding the line CS_n low at the reset of
the FPGA. &lt;/p&gt;
&lt;p style="width:600px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="iCE40 development board and Raspberry Pi" src="www.j-marjanovic.io/images/ice40_rpi_conf.jpg"&gt;&lt;/p&gt;
&lt;p&gt;So I tried programming it using Raspberry Pi. I connected:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;grounds together&lt;/li&gt;
&lt;li&gt;SI on iCE40 to MOSI on RPi&lt;/li&gt;
&lt;li&gt;SO on iCE40 to MISO on RPi (this one is actually not needed)&lt;/li&gt;
&lt;li&gt;SCK on iCE40 to CLK on RPi&lt;/li&gt;
&lt;li&gt;pin GPIO25 on RPi to SS on iCE40 (this one is needed to enter the slave mode)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I wrote the following script and used one of the .bin files from one of the project
in iCEcube2. &lt;/p&gt;
&lt;script src="https://gist.github.com/j-marjanovic/cb271e861d279a31775d.js"&gt;&lt;/script&gt;

&lt;p&gt;This is the output (well, the real output it is the configured board which blinks the LEDs while
the DONE led is lit):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;pi@raspberrypi ~/Jan/ice40/test1 $&lt;/span&gt; sudo bash conf_FPGA.sh proto1_top_bitmap.bin
&lt;span class="go"&gt;GPIO 25 not exported, trying to export...&lt;/span&gt;

&lt;span class="go"&gt;spidev does not exist&lt;/span&gt;
&lt;span class="go"&gt;SPI driver not loaded, try to load it...&lt;/span&gt;
&lt;span class="go"&gt;OK: SPI driver loaded&lt;/span&gt;

&lt;span class="go"&gt;Changing direction to out&lt;/span&gt;
&lt;span class="go"&gt;out&lt;/span&gt;
&lt;span class="go"&gt;Setting output to low&lt;/span&gt;
&lt;span class="go"&gt;1&lt;/span&gt;

&lt;span class="go"&gt;Please power cycle the iCE40 FPGA board&lt;/span&gt;
&lt;span class="go"&gt;Press any key...&lt;/span&gt;

&lt;span class="go"&gt;Continuing with configuration procedure&lt;/span&gt;
&lt;span class="go"&gt;63+1 records in&lt;/span&gt;
&lt;span class="go"&gt;63+1 records out&lt;/span&gt;
&lt;span class="go"&gt;32300 bytes (32 kB) copied, 0.606931 s, 53.2 kB/s&lt;/span&gt;
&lt;span class="go"&gt;Setting output to high&lt;/span&gt;
&lt;span class="go"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I find this type of configuration very useful when the FPGA is not the main
chip in the system (when there is as in the previous example an RPi). The 
configuration file can be stored on Raspberry Pi SD card and at each start-up
the FPGA gets programmed. The image update can be done very easily and there 
is no way a user can brick the FPGA (which can easily happen if the FPGA writes
the configuration image and boots from its Flash, in this case two images 
(factory and user) are recommended).&lt;/p&gt;</content><category term="Lattice"></category><category term="iCE40"></category><category term="FPGA"></category><category term="Raspberry Pi"></category><category term="bash"></category></entry><entry><title>My first encounter with Lattice Semiconductor</title><link href="www.j-marjanovic.io/my-first-encounter-with-lattice-semiconductor.html" rel="alternate"></link><published>2014-12-24T20:00:00+01:00</published><updated>2014-12-24T20:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-12-24:www.j-marjanovic.io/my-first-encounter-with-lattice-semiconductor.html</id><summary type="html">&lt;p&gt;The FPGA market is one of those classical markets where there are two players 
who have nearly 100% market share, e.g. PC processors (Intel and AMD), graphic
cards (NVIDIA and ATI), ... The two mayor players on the FPGA market are Xilinx
and Altera. Both of this two companies follows …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The FPGA market is one of those classical markets where there are two players 
who have nearly 100% market share, e.g. PC processors (Intel and AMD), graphic
cards (NVIDIA and ATI), ... The two mayor players on the FPGA market are Xilinx
and Altera. Both of this two companies follows their rival very closely.
When one company announces the next big thing, support for new technology or
improvement to their current products, the other will shortly follow with
similar announcement.&lt;/p&gt;
&lt;p&gt;This tempo of development has brought the two main programs of these two rivals
at very high level. There is a tool (Altera Qsys and Xilinx Vivado) which lets 
you build a system from standardized building blocks with standardized 
interfaces (Altera Avalon and ARM AXI). They both offer a large palette of IP
ready to be used with their program. The debugging of the designs is simplified
with good integration with simulators (Altera by default uses Mentor Graphic 
ModelSim, Xilinx has its own XSim, but it can also use ModelSim) and integrated 
logic analysers (Altera SignalTap and Xilinx ILA) are a great help when 
simulation works but real world FPGA does not.&lt;/p&gt;
&lt;p&gt;I have an idea for my next hobby project which needs an FPGA (actually, CPLD will
do just fine) for translating one communication protocol to another. The board
will be an expansion board for Raspberry Pi, so the cost should be really low 
(I have in mind something bellow 5$). Altera and Xilinx do not offer anything in
this price range, so I recalled Lattice ads. The iCE40 series are small FPGAs
with few K logic cells and low prices. Another advantage for my project is 
possibility to configure it by SPI, something that most CPLDs does not support.&lt;/p&gt;
&lt;p&gt;So I ordered &lt;a href="http://www.latticesemi.com/iceblink40-hx1k"&gt;iCEblink40HX1K Evaluation Kit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;First I tried installing the iCEcube2 software on Centos 7 which is my usual
working environment. The installation went smoothly. The problem started to occur 
when the licence manager was unable to find network adapter MAC address:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;Error&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt; &lt;span class="nv"&gt;License&lt;/span&gt; &lt;span class="s s-Atom"&gt;checkout&lt;/span&gt; &lt;span class="s s-Atom"&gt;failed&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;


&lt;span class="nv"&gt;Invalid&lt;/span&gt; &lt;span class="s s-Atom"&gt;host&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
 &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="s s-Atom"&gt;hostid&lt;/span&gt; &lt;span class="s s-Atom"&gt;of&lt;/span&gt; &lt;span class="s s-Atom"&gt;this&lt;/span&gt; &lt;span class="s s-Atom"&gt;system&lt;/span&gt; &lt;span class="s s-Atom"&gt;does&lt;/span&gt; &lt;span class="o"&gt;not&lt;/span&gt; &lt;span class="s s-Atom"&gt;match&lt;/span&gt; &lt;span class="s s-Atom"&gt;the&lt;/span&gt; &lt;span class="s s-Atom"&gt;hostid&lt;/span&gt;
 &lt;span class="s s-Atom"&gt;specified&lt;/span&gt; &lt;span class="s s-Atom"&gt;in&lt;/span&gt; &lt;span class="s s-Atom"&gt;the&lt;/span&gt; &lt;span class="s s-Atom"&gt;license&lt;/span&gt; &lt;span class="s s-Atom"&gt;file&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nv"&gt;Feature&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;       &lt;span class="nv"&gt;LSC_ICECUBE2_A&lt;/span&gt;
&lt;span class="nv"&gt;Hostid&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;        &lt;span class="s s-Atom"&gt;xxxxxxxxxxxx&lt;/span&gt;
&lt;span class="nv"&gt;License&lt;/span&gt; &lt;span class="nn"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;jan&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;lscc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;license&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;dat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="nv"&gt;FLEXnet&lt;/span&gt; &lt;span class="nv"&gt;Licensing&lt;/span&gt; &lt;span class="nn"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mf"&gt;57.&lt;/span&gt;  &lt;span class="nv"&gt;System&lt;/span&gt; &lt;span class="nv"&gt;Error&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;(null)&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;For&lt;/span&gt; &lt;span class="s s-Atom"&gt;further&lt;/span&gt; &lt;span class="s s-Atom"&gt;information&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s s-Atom"&gt;refer&lt;/span&gt; &lt;span class="s s-Atom"&gt;to&lt;/span&gt; &lt;span class="s s-Atom"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;FLEXnet&lt;/span&gt; &lt;span class="nv"&gt;Licensing&lt;/span&gt; &lt;span class="nv"&gt;End&lt;/span&gt; &lt;span class="nv"&gt;User&lt;/span&gt; &lt;span class="nv"&gt;Guide&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="s s-Atom"&gt;available&lt;/span&gt; &lt;span class="s s-Atom"&gt;at&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;www.macrovision.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The problem is that the FLEXnet software searches for the MAC address of the eth*
interface, while Centos uses completely different naming. Being familiar with the
problem, I used a trick to create a new interface named eth0 (you should replace
the x's with desired MAC address):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;modprobe dummy
ip link set name eth0 dev dummy0
ifconfig eth0 hw ether xx:xx:xx:xx:xx:xx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After setting everything up, a view on the iCEcube2 showed before me.&lt;/p&gt;
&lt;p&gt;&lt;img alt="iCEcube2" src="www.j-marjanovic.io/images/icestudio.png"&gt;&lt;/p&gt;
&lt;p&gt;It is a little Spartan but it has all basic functions the FPGA developer needs. The
text editor lacks code coloring, auto-complete but there is a chance to use a 3rd
party text editor. The text in the output window is light violet on white background
and it should be changed to something more visible.&lt;/p&gt;
&lt;p&gt;The iCE family of FPGAs lacks JTAG port. Instead, user programs SPI Flash memory
through an USB to SPI converter and then the FPGA boots from SPI memory. That means
that debugging is done or by using 4 LEDs on the side or with oscilloscope, not a 
very user friendly approach.&lt;/p&gt;
&lt;p&gt;Under Linux, there is additional problem:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Note&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;The&lt;/span&gt; &lt;span class="n"&gt;Integrated&lt;/span&gt; &lt;span class="n"&gt;Aldec&lt;/span&gt; &lt;span class="n"&gt;Active&lt;/span&gt; &lt;span class="n"&gt;HDL&lt;/span&gt; &lt;span class="n"&gt;simulation&lt;/span&gt; &lt;span class="n"&gt;software&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;iCEcube2&lt;/span&gt; &lt;span class="n"&gt;programming&lt;/span&gt; 
&lt;span class="n"&gt;tools&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;only&lt;/span&gt; &lt;span class="n"&gt;available&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="n"&gt;windows&lt;/span&gt; &lt;span class="n"&gt;platform&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Well this is it for now, i need to switch to Windows. Merry Christmas to everybody!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;All trademarks and registered trademarks are the property of their respective owners.&lt;/p&gt;</content><category term="Lattice"></category><category term="iCE40"></category><category term="FPGA"></category></entry><entry><title>Theremin First Demo</title><link href="www.j-marjanovic.io/theremin-first-demo.html" rel="alternate"></link><published>2014-11-18T23:00:00+01:00</published><updated>2014-11-18T23:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-11-18:www.j-marjanovic.io/theremin-first-demo.html</id><summary type="html">&lt;p&gt;During the weekend I was able to take some time to do first test of the theremin.
Here are two recordings of my friend Luka playing.&lt;/p&gt;
&lt;iframe width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/177559922&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_comments=true&amp;amp;show_user=true&amp;amp;show_reposts=false&amp;amp;visual=true"&gt;&lt;/iframe&gt;

&lt;iframe width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/177561150&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_comments=true&amp;amp;show_user=true&amp;amp;show_reposts=false&amp;amp;visual=true"&gt;&lt;/iframe&gt;

&lt;p&gt;There are some more articles explaining how digital theremin works coming,
 remember to check out my blog.&lt;/p&gt;</summary><content type="html">&lt;p&gt;During the weekend I was able to take some time to do first test of the theremin.
Here are two recordings of my friend Luka playing.&lt;/p&gt;
&lt;iframe width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/177559922&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_comments=true&amp;amp;show_user=true&amp;amp;show_reposts=false&amp;amp;visual=true"&gt;&lt;/iframe&gt;

&lt;iframe width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/177561150&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_comments=true&amp;amp;show_user=true&amp;amp;show_reposts=false&amp;amp;visual=true"&gt;&lt;/iframe&gt;

&lt;p&gt;There are some more articles explaining how digital theremin works coming,
 remember to check out my blog.&lt;/p&gt;</content><category term="Theremin"></category></entry><entry><title>I just got a Nintendo 64</title><link href="www.j-marjanovic.io/i-just-got-a-nintendo-64.html" rel="alternate"></link><published>2014-11-16T18:00:00+01:00</published><updated>2014-11-16T18:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-11-16:www.j-marjanovic.io/i-just-got-a-nintendo-64.html</id><summary type="html">&lt;p&gt;I just got a Nintendo 64, my friend Rok was kind enough to lend it.&lt;/p&gt;
&lt;p style="width:700px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Nintendo 64" src="www.j-marjanovic.io/images/N64.png"&gt;&lt;/p&gt;
&lt;p&gt;I have an interesting project in mind, I will keep you updated.
Rok will for sure be the first one to get the alpha version.&lt;/p&gt;</summary><content type="html">&lt;p&gt;I just got a Nintendo 64, my friend Rok was kind enough to lend it.&lt;/p&gt;
&lt;p style="width:700px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Nintendo 64" src="www.j-marjanovic.io/images/N64.png"&gt;&lt;/p&gt;
&lt;p&gt;I have an interesting project in mind, I will keep you updated.
Rok will for sure be the first one to get the alpha version.&lt;/p&gt;</content><category term="Nintendo 64"></category></entry><entry><title>Theremin Antenna Measurements</title><link href="www.j-marjanovic.io/theremin-antenna-measurements.html" rel="alternate"></link><published>2014-11-09T09:00:00+01:00</published><updated>2014-11-09T09:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-11-09:www.j-marjanovic.io/theremin-antenna-measurements.html</id><summary type="html">&lt;p&gt;Last week I briefly explained how theremin works. I also presented my idea to develop a 
digital version, using FPGA as a detector of distance between hand and antenna.&lt;/p&gt;
&lt;p&gt;You have probably already heard a joke about theory and practice. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Theory is when you know everything but nothing works. Practice …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;Last week I briefly explained how theremin works. I also presented my idea to develop a 
digital version, using FPGA as a detector of distance between hand and antenna.&lt;/p&gt;
&lt;p&gt;You have probably already heard a joke about theory and practice. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Theory is when you know everything but nothing works. Practice is when everything works
 but no one knows why. Here we combine the two, nothing works and no one knows why.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Jokes aside, today we will try to measure the time constant of the antenna. In this 
implementation of theremin the measured time constant will be a control for tone pitch. 
Having a good measurement of time constant is therefore very important. A good instrument 
will produce stable tone when hand is hold still. Also, the quality of measurement of 
time constant determines a difference between two consecutive tones and fine control 
of the pitch is also desired.&lt;/p&gt;
&lt;p&gt;Here you can see this highly advanced test - a ruler strapped to the antenna.
This will allow us to measure the relationship between time constant and distance of
the hand. &lt;/p&gt;
&lt;p style="width:441px; display: block; margin-left: auto; margin-right: auto;"&gt;&lt;img alt="Test setup" src="www.j-marjanovic.io/images/theremin_antena_meas.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Since the ruler is made out of plastic (we should say dielectric, when studying electric
fields) it won't affect the antenna field.&lt;/p&gt;
&lt;p&gt;The FPGA is producing a square wave signal at 10kHz, which is then sent to antenna through
a 2.2 MOhm resistor. The resistor is on the other side connected to antenna, thus creating an
RC circuit. The voltage on antenna is feed back to FPGA through a Schmitt Trigger to improve
the measured value. The module in FPGA measures how much time did it take for voltage on
antenna to reach certain value (determined by Schmitt Trigger). This time is directly 
correlated to time constant and therefore to capacitance of the antenna.&lt;/p&gt;
&lt;p&gt;Here we see what the FPGA measured when I placed hand on different distance from antenna.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Time constant without filtering" src="www.j-marjanovic.io/images/theremin_antenna_direct.png"&gt;&lt;/p&gt;
&lt;p&gt;The blue dots denote mean value, the green lines denote one standard deviation and the
black lines denote minimum and maximum value.&lt;/p&gt;
&lt;p&gt;Right now, the measurements do not look very promising, we can see some increase of time
constant as hand approaches antenna, but the noise is extremely high.&lt;/p&gt;
&lt;p&gt;If we have a look at the frequency spectrum of the measurement, we see the reason for the
noise.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Time constant spectral analysis" src="www.j-marjanovic.io/images/theremin_antenna_direct_fft.png"&gt;&lt;/p&gt;
&lt;p&gt;The antenna is 45 cm long copper rod and acts not only as a capacitor for theremin but also
as radio antenna. All the frequency components above Nyquist frequency (which is 5000 kHz
in our case) are being aliased to lower frequencies in our frequency range. A 50Hz signal
from mains is also being picked up.&lt;/p&gt;
&lt;p&gt;We need a filter! A filter will reject all the undesired frequencies and that will greatly
improve.&lt;/p&gt;
&lt;p&gt;I will write another article on filtering in FPGA, meanwhile let's enjoy much improved 
results:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Time constant with filtering" src="www.j-marjanovic.io/images/theremin_antenna_filtered.png"&gt;&lt;/p&gt;</content><category term="Theremin"></category></entry><entry><title>Theremin Basics</title><link href="www.j-marjanovic.io/theremin-basics.html" rel="alternate"></link><published>2014-11-06T22:00:00+01:00</published><updated>2014-11-06T22:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-11-06:www.j-marjanovic.io/theremin-basics.html</id><summary type="html">&lt;p&gt;Theremin, a first electronic instrument. Leon Theremin invented it in 1928. 
Try to imagine people seeing somebody waving hand in the middle or the air
and producing an extraterrestrial sounds. Theremin, should be considered a 
true pioneer of electronic music.&lt;/p&gt;
&lt;p&gt;The operational principle is quite simple, however an good implementation …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Theremin, a first electronic instrument. Leon Theremin invented it in 1928. 
Try to imagine people seeing somebody waving hand in the middle or the air
and producing an extraterrestrial sounds. Theremin, should be considered a 
true pioneer of electronic music.&lt;/p&gt;
&lt;p&gt;The operational principle is quite simple, however an good implementation is
not so trivial. I recall playing on it in Deutsches Museum in Munich and that
particular model had a sphere as an antenna. The tone frequency is dependant
on antenna capacitance. To achive maximum control, the relationship between
capacitance and distance between hand and antenna should be linear. However,
the model in Munich had reciprocal relationship and that made hitting right 
notes quite hard.&lt;/p&gt;
&lt;p&gt;I am going to make a new version of theremin, a reinterpretation for 21st
century. I will still use antenna to control the pitch, but the "back-end"
will be completely different. &lt;/p&gt;
&lt;p&gt;The antenna acts as one plate of the capacitor and the hand is the other.
I did a quick simulation in Python to be able to show some numbers. This is
meant to be a demonstration of operating principle, so it lacks few
not-so-minor details. The calculations were done in 2D, where antenna in 
real world exist in 3 dimensions. &lt;/p&gt;
&lt;p&gt;&lt;img alt="Theremin simulation" src="www.j-marjanovic.io/images/theremin_antenna.gif"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="/drafts/theremin-simulation.html"&gt;Code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Now we know that antenna acts as a capacitor, so next challenge is to
produce a tone with the pitch related to capacitance. The original Theremin
uses antenna as a capacitor of the LC resonator. Here is the first big
difference between my implementation and original one, I will be measuring
time constant of the RC circuit with an FPGA. &lt;/p&gt;
&lt;p&gt;The FPGA will generate a square wave and feed it to antenna through a
resistance. This will create a current which will charge capacitor (antenna).
The other circuit (module) in FPGA will measure time needed for voltage on 
capacitor to reach certain level. A bigger capacitance (smaller distance 
between hand and antenna)  will result in longer time and a smaller
capacitance (longer distance between hand and antenna) will result in shorter
time. This difference will generate a different pitch.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Theremin settling time" src="www.j-marjanovic.io/images/theremin_settling_time.png"&gt;&lt;/p&gt;
&lt;p&gt;This is all for this part, stay tuned for more.&lt;/p&gt;</content><category term="Theremin"></category></entry><entry><title>Hello world</title><link href="www.j-marjanovic.io/hello-world.html" rel="alternate"></link><published>2014-11-02T13:00:00+01:00</published><updated>2014-11-02T13:00:00+01:00</updated><author><name>Jan Marjanovic</name></author><id>tag:None,2014-11-02:www.j-marjanovic.io/hello-world.html</id><summary type="html">&lt;p&gt;Hi and welcome to my blog.&lt;/p&gt;
&lt;p&gt;This is a "hello world" style post, I am curently testing pelican static blog generator.
Since I don't know how much time I will have to manage this blog I prefer that everything 
is static. If I some day stop writing this blog, at …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hi and welcome to my blog.&lt;/p&gt;
&lt;p&gt;This is a "hello world" style post, I am curently testing pelican static blog generator.
Since I don't know how much time I will have to manage this blog I prefer that everything 
is static. If I some day stop writing this blog, at least there won't be any security threats
due to out-of-date web page.&lt;/p&gt;
&lt;p&gt;This blog will be about one of my biggest passions, electronics and technology in general.
Since I was a kid I was curious about electronic devices and to this day I always enjoy
taking thing appart (and sometimes also together, that is what I am being paid for). &lt;/p&gt;
&lt;p&gt;This is all for now, let's see if it "compiles"...&lt;/p&gt;</content></entry></feed>