<!DOCTYPE html>
<html lang="en">
<head>
        <title>Exploring cache coherency on Zynq MPSoC</title>
        <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="../theme/images/favicon.ico"/>
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
        <link href="www.j-marjanovic.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j-marjanovic.io Atom Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" src="theme/jquery.cookiesdirective.js"></script>

</head>

<body id="index" class="home">
<script type="text/javascript">
	// Using $(document).ready never hurts
	$(document).ready(function(){

		// Cookie setting script wrapper
		var cookieScripts = function () {
			// Internal javascript called
			console.log("Running");
		
			// Loading external javascript file
			$.cookiesDirective.loadScript({
				uri:'external.js',
				appendTo: 'eantics'
			});
		}
	
		/* Call cookiesDirective, overriding any default params
		
			*** These are the defaults ***
				explicitConsent: true,
				position: 'top',
				duration: 10,
				limit: 0,
				message: null,				
				cookieScripts: null,
				privacyPolicyUri: 'privacy.html',
				scriptWrapper: function(){},	
				fontFamily: 'helvetica',
				fontColor: '#FFFFFF',
				fontSize: '13px',
				backgroundColor: '#000000',
				backgroundOpacity: '80',
				linkColor: '#CA0000'
				
		*/
		
		$.cookiesDirective({
			privacyPolicyUri: 'myprivacypolicy.html',
			explicitConsent: false,
			position : 'bottom',
			scriptWrapper: cookieScripts, 
			cookieScripts: 'Google Analytics', 
			backgroundColor: '#52B54A',
			linkColor: '#ffffff'
		});
	});
</script>

	
  <!-- <header id="banner" class="body"> -->
  <!--               <h1><a href="../"><img src="http://www.launchyard.com/images/logo.png" /></a></h1> -->
  <!--       </header> --> 

  <div class="LaunchyardDetail" style="align:right;">
    <!-- <p> -->
    <!-- <img src="../theme/images/blue-pin.png" width="100" height="100" alt="Graph icon"> -->
    <!-- </p> -->
    <p><a id="sitesubtitle" href="../">j-marjanovic.io</a></p>

	<br>
    <p style="float: right; margin-right: 50px;"><a id="aboutlink" href="../pages/about.html">About</a></p>

    <br>
	<p style="float: right; margin-right: 50px;"><img src="../theme/images/icons/rss.png"> <a id="aboutlink" href="../feeds/jan-marjanovic.atom.xml">Atom feed</a></p>
    <br>

  </div>

<section id="content" >
    <div class="body">
      <article>
        <header>
          <h1 class="entry-title">
            <a href="../drafts/exploring-cache-coherency-on-zynq-mpsoc.html" rel="bookmark"
               title="Permalink to Exploring cache coherency on Zynq MPSoC">Exploring cache coherency on Zynq MPSoC</a></h1>

        </header>

        <div class="entry-content">
<div class="post-info">
	<ul>
        <li class="vcard author">
                 by&nbsp;<a class="url fn" href="../author/jan-marjanovic.html">Jan Marjanovic</a>
        </li>
        <li class="published" title="9999-12-31T23:59:59.999999+00:53">
          on&nbsp;
        </li>

	</ul>

</div><!-- /.post-info -->          <p>In modern processors with several processors (TOOD), several levels
of cache and possibly other bus managers, maintaining (consistent view of the data) cache coherence is
an important topic. Several approaches can be employed to satisfy this requirement;
when dealing with data acquisition systems the easiest approach is to disable
the caching altogether. On the other side, when the data direction is not so well
defined, other approaches, such as hardware-maintained cache coherence are
more suitable.</p>
<h1>Introduction</h1>
<h2>Xilinx Zynq MPSoC</h2>
<p>I believe that most of the readers of my blog are already familiar with Zynq MPSoC,
but for the sake of completeness let's do a quick introduction. Zynq MPSoC is
a device, which combines a quad-core ARM Cortex-A53 in the same package with
a relatively large FPGA.  The two parts are connected together with a massive
interconnect, consisting of several AXI ports towards the FPGA part.</p>
<h2>AXI bus</h2>
<p>AxCACHE</p>
<h2>Lamport's bakery algorithm</h2>
<h1>Setup</h1>
<h2>U-dma-buf</h2>
<h2>Linux kernel</h2>
<div class="highlight"><pre><span></span><code>CONFIG_ARM64_PTDUMP_CORE=y
CONFIG_ARM64_PTDUMP_DEBUGFS=y
</code></pre></div>

<h2>Performance counters</h2>
<p>TODO: block diagram</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@u96v2</span><span class="o">-</span><span class="nl">sbc</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">devmem</span><span class="w"> </span><span class="mh">0xFD5E0000</span><span class="w"></span>
<span class="n">Bus</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="n">root</span><span class="nv">@u96v2</span><span class="o">-</span><span class="nl">sbc</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">devmem</span><span class="w"> </span><span class="mh">0xFD5E0040</span><span class="w"></span>
<span class="n">Bus</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Xilinx</span> <span class="n">Zynq</span> <span class="n">MP</span> <span class="n">First</span> <span class="n">Stage</span> <span class="n">Boot</span> <span class="n">Loader</span> 
<span class="n">Release</span> <span class="mf">2020.2</span>   <span class="n">Jun</span> <span class="mh">10</span> <span class="mh">2021</span>  <span class="o">-</span>  <span class="mh">17</span><span class="o">:</span><span class="mh">49</span><span class="o">:</span><span class="mh">38</span>
<span class="n">Reset</span> <span class="n">Mode</span>      <span class="o">:</span>       <span class="n">System</span> <span class="n">Reset</span>
<span class="nl">Platform:</span> <span class="n">Silicon</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">),</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">A53</span><span class="o">-</span><span class="mh">0</span> <span class="p">(</span><span class="mh">64</span><span class="o">-</span><span class="kt">bit</span><span class="p">)</span> <span class="n">Processor</span><span class="p">,</span> <span class="n">Device</span> <span class="nl">Name:</span> <span class="n">XCZU3EG</span>
<span class="n">SD0</span> <span class="n">Boot</span> <span class="n">Mode</span> 
<span class="n">PMU</span> <span class="n">Firmware</span> <span class="mf">2020.2</span>     <span class="n">Jun</span>  <span class="mh">3</span> <span class="mh">2021</span>   <span class="mh">18</span><span class="o">:</span><span class="mh">28</span><span class="o">:</span><span class="mh">36</span>
<span class="n">PMU_ROM</span> <span class="nl">Version:</span> <span class="n">xpbr</span><span class="o">-</span><span class="n">v8</span><span class="mf">.1.0</span><span class="o">-</span><span class="mh">0</span>
<span class="n">Protection</span> <span class="n">configuration</span> <span class="n">applied</span>
<span class="n">EL</span> <span class="o">=</span> <span class="mh">3</span>
<span class="nl">CCI_REG:</span> <span class="n">register</span> <span class="n">dump</span>
  <span class="n">offset</span> <span class="mh">0</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">10</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">14</span> <span class="o">=</span> <span class="mf">8000003F</span>
  <span class="n">offset</span> <span class="mh">18</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">1</span><span class="n">C</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">40</span> <span class="o">=</span> <span class="mh">0</span>
<span class="nl">CCI_REG:</span> <span class="n">debug</span> <span class="n">enable</span>
<span class="nl">CCI_REG:</span> <span class="n">register</span> <span class="n">dump</span>
  <span class="n">offset</span> <span class="mh">0</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">10</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">14</span> <span class="o">=</span> <span class="mf">8000003F</span>
  <span class="n">offset</span> <span class="mh">18</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">1</span><span class="n">C</span> <span class="o">=</span> <span class="mh">0</span>
  <span class="n">offset</span> <span class="mh">40</span> <span class="o">=</span> <span class="mh">3</span>
<span class="n">Exit</span> <span class="n">from</span> <span class="n">FSBL</span> 
</code></pre></div><script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div><!-- /.entry-content -->
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="janmarjanovic">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><br/><br/>

      </article>
    </div>
</section>
        <section id="extras" >
        
        </section><!-- /#extras -->
	
        <footer id="contentinfo" >
                <address id="about" class="vcard ">
                Proudly powered by <a href="https://getpelican.com/" target="_blank">Pelican</a>, which takes
                great advantage of <a href="https://python.org" target="_blank">Python</a>.
		
                </address><!-- /#about -->
		

                
        </footer><!-- /#contentinfo -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56555055-1', 'auto');
  ga('send', 'pageview');

</script></body>
</html>